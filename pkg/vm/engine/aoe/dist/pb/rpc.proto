syntax = "proto3";
package pb;


import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "meta.proto";

option (gogoproto.marshaler_all) = true;
option (gogoproto.sizer_all) = true;
option (gogoproto.unmarshaler_all) = true;
option (gogoproto.goproto_enum_prefix_all) = false;


enum Type {
  Set = 0;
  Del = 1;
  Get = 2;
  PrefixScan = 3;
  Scan = 4;
  Incr = 5;

  Append = 100;
  GetSnapshot = 101;
  CreateTablet = 102;
  DropTablet = 103;
  Relation = 104;
  TabletIds = 105;
  TabletNames = 106;
}

message Request {
  uint64                       id = 1  [(gogoproto.customname) = "ID"];
  Type                         type = 2;
  pb.Group                     group = 3;
  uint64 shard = 4;
  SetRequest                   set = 5  [(gogoproto.nullable) = false];
  GetRequest                   get = 6  [(gogoproto.nullable) = false];
  DeleteRequest                delete = 7  [(gogoproto.nullable) = false];
  ScanRequest                  scan = 8  [(gogoproto.nullable) = false];
  PrefixScanRequest               prefixScan = 9  [(gogoproto.nullable) = false];
  AllocIDRequest               allocID = 10 [(gogoproto.nullable) = false];

  AppendRequest append = 100 [(gogoproto.nullable) = false];
  GetSnapshotRequest getSnapshot = 101 [(gogoproto.nullable) = false];
  TabletIDsRequest tabletIds = 102 [(gogoproto.nullable) = false];
  CreateTabletRequest createTablet = 103 [(gogoproto.nullable) = false];
  DropTabletRequest dropTablet = 104 [(gogoproto.nullable) = false];
}


message Response {
  uint64                        id = 1  [(gogoproto.customname) = "ID"];
  Type                          type = 2;
  ErrorResponse                 error = 3  [(gogoproto.nullable) = false];
  BytesResponse                 bytesResp = 4  [(gogoproto.nullable) = false];
  BoolResponse                  boolResp = 5  [(gogoproto.nullable) = false];
  Uint64Response                uint64Resp = 6  [(gogoproto.nullable) = false];
  Uint32Response                uint32Resp = 7  [(gogoproto.nullable) = false];
  BytesSliceResponse            bytesSliceResp = 8 [(gogoproto.nullable) = false];
  StringResponse                stringResp = 9 [(gogoproto.nullable) = false];
}

// SetRequest set a key value pair
message SetRequest {
  bytes  key = 1;
  bytes  value = 2;
  int64  ttl = 3 [(gogoproto.customname) = "TTL"];
}

// GetRequest get value by key
message GetRequest {
  bytes        key = 1;
}

// DeleteRequest remove a key value pair
message DeleteRequest {
  bytes key = 1;
}

// AllocIDRequest alloc id request
message AllocIDRequest {
  bytes  key = 1;
  uint64 batch = 2;
}

// ScanRequest scan request
message ScanRequest {
  bytes        start = 1;
  bytes        end = 2;
  uint64       limit = 3;
}

// PrefixScanRequest scan request
message PrefixScanRequest {
  bytes        prefix = 1;
  bytes        startKey = 2;
  uint64       limit = 3;
}

message AppendRequest {
  string tabletName = 1;
  bytes data = 2;
}

message GetSnapshotRequest {
  bytes ctx = 1;
}

message TabletIDsRequest {
}

message CreateTabletRequest {
  bytes tabletInfo = 1;
}

message DropTabletRequest {
  string name = 1;
}

// ErrorResponse error response
message ErrorResponse {
  string error = 1;
}

// EmptyResponse empty response
message EmptyResponse {

}

// StringResponse response
message StringResponse {
  string value = 1;
}

// BytesResponse response
message BytesResponse {
  bytes value = 1;
}

// BoolResponse response
message BoolResponse {
  bool  value = 1;
}

// Uint64Response response
message Uint64Response {
  uint64 value = 1;
}

// BytesSliceResponse response
message BytesSliceResponse {
  repeated bytes keys = 1;
  repeated bytes values = 2;
  uint64         lastValue = 3;
}

// Uint32Response uint32 response
message Uint32Response {
  uint32 value = 1;
}
