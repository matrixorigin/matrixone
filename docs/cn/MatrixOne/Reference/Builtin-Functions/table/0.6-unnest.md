# **UNNEST()**

`UNNEST` 函数将一个 `ARRAY` 参数作为输入，返回一个表，其中每个 `ARRAY` 元素都返回一行。

空数组和 `NULL` 作为输入时，返回空表。包含 `NULL` 值的数组将生成一行 `NULL` 值。

## **函数语法**

```
> UNNEST(ARRAY) [WITH OFFSET]
```

## **参数释义**

|  参数   | 说明  |
|  ----  | ----  |
| ARRAY | 必要参数。 `ARRAY` 作为输入，但可以返回任何结构的表。 |
|WITH OFFSET |可选参数。 `WITH OFFSET` 子句为 `UNNEST` 生成的每一行提供了一个额外的列，包含l 数组中每个元素的位置(从0开始)。|

## **示例**

- 示例 1：

```sql
> select * from unnest('{"a":1}') u;
+----------------+------+------+------+-------+-------+----------+
| col            | seq  | key  | path | index | value | this     |
+----------------+------+------+------+-------+-------+----------+
| UNNEST_DEFAULT |    0 | a    | $.a  |  NULL | 1     | {"a": 1} |
+----------------+------+------+------+-------+-------+----------+
1 row in set (0.00 sec)

> select * from unnest('[1,2,3]') u;
+----------------+------+------+------+-------+-------+-----------+
| col            | seq  | key  | path | index | value | this      |
+----------------+------+------+------+-------+-------+-----------+
| UNNEST_DEFAULT |    0 | NULL | $[0] |     0 | 1     | [1, 2, 3] |
| UNNEST_DEFAULT |    0 | NULL | $[1] |     1 | 2     | [1, 2, 3] |
| UNNEST_DEFAULT |    0 | NULL | $[2] |     2 | 3     | [1, 2, 3] |
+----------------+------+------+------+-------+-------+-----------+
3 rows in set (0.00 sec)

> select * from unnest('[1,2,3]','$') u;
+----------------+------+------+------+-------+-------+-----------+
| col            | seq  | key  | path | index | value | this      |
+----------------+------+------+------+-------+-------+-----------+
| UNNEST_DEFAULT |    0 | NULL | $[0] |     0 | 1     | [1, 2, 3] |
| UNNEST_DEFAULT |    0 | NULL | $[1] |     1 | 2     | [1, 2, 3] |
| UNNEST_DEFAULT |    0 | NULL | $[2] |     2 | 3     | [1, 2, 3] |
+----------------+------+------+------+-------+-------+-----------+
3 rows in set (0.01 sec)

> select * from unnest('[1,2,3]','$[0]',true) u;
+----------------+------+------+------+-------+-------+------+
| col            | seq  | key  | path | index | value | this |
+----------------+------+------+------+-------+-------+------+
| UNNEST_DEFAULT |    0 | NULL | $[0] |  NULL | NULL  | 1    |
+----------------+------+------+------+-------+-------+------+
1 row in set (0.00 sec)
```

- 示例 2：

```sql
> create table t1 (a json,b int);
> insert into t1 values ('{"a":1,"b":[{"c":2,"d":3},false,4],"e":{"f":true,"g":[null,true,1.1]}}',1);
> insert into t1 values ('[1,true,false,null,"aaa",1.1,{"t":false}]',2);
> select * from t1;
+---------------------------------------------------------------------------------------+------+
| a                                                                                     | b    |
+---------------------------------------------------------------------------------------+------+
| {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}} |    1 |
| [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |    2 |
+---------------------------------------------------------------------------------------+------+
2 rows in set (0.00 sec)

> select * from unnest(t1.a) as f;
+------+------+------+------+-------+-------------------------------------+---------------------------------------------------------------------------------------+
| col  | seq  | key  | path | index | value                               | this                                                                                  |
+------+------+------+------+-------+-------------------------------------+---------------------------------------------------------------------------------------+
| a    |    0 | a    | $.a  |  NULL | 1                                   | {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}} |
| a    |    0 | b    | $.b  |  NULL | [{"c": 2, "d": 3}, false, 4]        | {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}} |
| a    |    0 | e    | $.e  |  NULL | {"f": true, "g": [null, true, 1.1]} | {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}} |
| a    |    1 | NULL | $[0] |     0 | 1                                   | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
| a    |    1 | NULL | $[1] |     1 | true                                | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
| a    |    1 | NULL | $[2] |     2 | false                               | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
| a    |    1 | NULL | $[3] |     3 | null                                | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
| a    |    1 | NULL | $[4] |     4 | "aaa"                               | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
| a    |    1 | NULL | $[5] |     5 | 1.1                                 | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
| a    |    1 | NULL | $[6] |     6 | {"t": false}                        | [1, true, false, null, "aaa", 1.1, {"t": false}]                                      |
+------+------+------+------+-------+-------------------------------------+---------------------------------------------------------------------------------------+
10 rows in set (0.01 sec)

> select * from unnest(t1.a, "$.b") as f;
+------+------+------+--------+-------+------------------+------------------------------+
| col  | seq  | key  | path   | index | value            | this                         |
+------+------+------+--------+-------+------------------+------------------------------+
| a    |    0 | NULL | $.b[0] |     0 | {"c": 2, "d": 3} | [{"c": 2, "d": 3}, false, 4] |
| a    |    0 | NULL | $.b[1] |     1 | false            | [{"c": 2, "d": 3}, false, 4] |
| a    |    0 | NULL | $.b[2] |     2 | 4                | [{"c": 2, "d": 3}, false, 4] |
+------+------+------+--------+-------+------------------+------------------------------+
3 rows in set (0.00 sec)

> select * from unnest(t1.a, "$.a", true) as f;
+------+------+------+------+-------+-------+------+
| col  | seq  | key  | path | index | value | this |
+------+------+------+------+-------+-------+------+
| a    |    0 | NULL | $.a  |  NULL | NULL  | 1    |
+------+------+------+------+-------+-------+------+
1 row in set (0.00 sec)
```
