# Prometheus configuration for MatrixOne services
# Supports both scenarios:
#   1. MatrixOne in Docker containers (make dev-up): Access via Docker network (mo-cn1:7001, etc.)
#   2. MatrixOne on host (make build + etc/launch/launch.toml): Access via host.docker.internal:7001
#
# All services use port 7001 for metrics endpoint
#
# Usage:
#   1. Make sure MatrixOne services have metrics enabled:
#      [observability]
#      disableMetric = false
#      enable-metric-to-prom = true
#      status-port = 7001
#
#   2. Start Grafana:
#      make dev-up-grafana-local
#
#   3. If host.docker.internal doesn't work (Linux), edit this file and replace
#      'host.docker.internal' with your actual host IP address (e.g., 192.168.1.100)
#
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'matrixone-local'

# Scrape configurations
# All services use port 7001
# Prometheus tries both Docker network (for containers) and host.docker.internal (for local)
scrape_configs:
  # MatrixOne in Docker containers (make dev-up)
  # Access via Docker network using container names
  - job_name: 'mo-log'
    static_configs:
      - targets: ['mo-log:7001']
        labels:
          service: 'logservice'
          instance: 'mo-log'

  - job_name: 'mo-cn1'
    static_configs:
      - targets: ['mo-cn1:7001']
        labels:
          service: 'cn'
          instance: 'mo-cn1'

  - job_name: 'mo-cn2'
    static_configs:
      - targets: ['mo-cn2:7001']
        labels:
          service: 'cn'
          instance: 'mo-cn2'

  - job_name: 'mo-tn'
    static_configs:
      - targets: ['mo-tn:7001']
        labels:
          service: 'tn'
          instance: 'mo-tn'

  - job_name: 'mo-proxy'
    static_configs:
      - targets: ['mo-proxy:7001']
        labels:
          service: 'proxy'
          instance: 'mo-proxy'

  # MatrixOne running on host (make build + etc/launch/launch.toml)
  # All services share the same metrics endpoint
  - job_name: 'mo-standalone'
    static_configs:
      - targets: ['host.docker.internal:7001']
        labels:
          deployment: 'standalone'
          instance: 'mo-standalone'

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
