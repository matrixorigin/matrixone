drop table if exists t1;
create table t1 (a int, b datetime);
insert into t1 values(1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13');
select sum(a) over(partition by a order by b range between interval 1 day preceding and interval 2 day following) from t1;
sum(a) over (partition by a order by b range between interval(1, day) preceding and interval(2, day) following)
1
2
3
drop table if exists t1;
create table t1 (a int, b date);
insert into t1 values(1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13'), (1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13'), (1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13');
select max(a) over(order by b range between interval 1 day preceding and interval 2 day following) from t1;
max(a) over (order by b range between interval(1, day) preceding and interval(2, day) following)
3
3
3
3
3
3
3
3
3
drop table if exists t1;
create table t1 (a int, b time);
insert into t1 values(1, 112233), (2, 122233), (3, 132233), (1, 112233), (2, 122233), (3, 132233), (1, 112233), (2, 122233), (3, 132233);
select min(a) over(order by b range between interval 1 hour preceding and current row) from t1;
min(a) over (order by b range between interval(1, hour) preceding and current row)
1
1
1
1
1
1
2
2
2
drop table if exists t1;
create table t1 (a int, b timestamp);
insert into t1 values(1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13'), (1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13'), (1, '2020-11-11'), (2, '2020-11-12'), (3, '2020-11-13');
select count(*) over(order by b range current row) from t1;
count(*) over (order by b range current row)
3
3
3
3
3
3
3
3
3
drop table if exists t1;
create table t1 (a int, b int, c int);
insert into t1 values(1, 2, 1), (3, 4, 2), (5, 6, 3), (7, 8, 4), (3, 4, 5), (3, 4, 6), (3, 4, 7);
select a, rank() over (partition by a) from t1 group by a, c;
a    rank() over (partition by a)
1    1
3    1
3    1
3    1
3    1
5    1
7    1
select a, c, rank() over (partition by a order by c) from t1 group by a, c;
a    c    rank() over (partition by a order by c)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, rank() over (partition by a order by c) from t1 group by a, c;
a    c    rank() over (partition by a order by c)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, b, rank() over (partition by a, c, b) from t1;
a    c    b    rank() over (partition by a, c, b)
1    1    2    1
3    2    4    1
3    5    4    1
3    6    4    1
3    7    4    1
5    3    6    1
7    4    8    1
select a,  b, rank() over (partition by a, b) from t1;
a    b    rank() over (partition by a, b)
1    2    1
3    4    1
3    4    1
3    4    1
3    4    1
5    6    1
7    8    1
select a, c, sum(a) over (), sum(c) over () from t1;
a    c    sum(a) over ()    sum(c) over ()
1    1    25    28
3    2    25    28
5    3    25    28
7    4    25    28
3    5    25    28
3    6    25    28
3    7    25    28
select a, c, sum(a) over (order by c), sum(c) over (order by a) from t1;
a    c    sum(a) over (order by c)    sum(c) over (order by a)
1    1    1    1
3    2    4    21
3    5    19    21
3    6    22    21
3    7    25    21
5    3    9    24
7    4    16    28
select a, sum(b), sum(sum(b)) over (partition by a), sum(sum(b)) over (partition by c) from t1 group by a, c;
a    sum(b)    sum(sum(b)) over (partition by a)    sum(sum(b)) over (partition by c)
1    2    2    2   
3    4    16    4   
5    6    6    6   
7    8    8    8   
3    4    16    4   
3    4    16    4   
3    4    16    4
select a, sum(b), rank() over (partition by a +1), rank() over (partition by c), c from t1 group by a, c;
a    sum(b)    rank() over (partition by a + 1)    rank() over (partition by c)    c
1    2    1    1    1
3    4    1    1    2
5    6    1    1    3
7    8    1    1    4
3    4    1    1    5
3    4    1    1    6
3    4    1    1    7
select a, sum(b), sum(sum(b))  over (partition by a) as o from t1 group by a, c;
a    sum(b)    o
1    2    2   
3    4    16  
3    4    16  
3    4    16  
3    4    16  
5    6    6   
7    8    8
select a, sum(b), cast(sum(sum(b))  over (partition by a+1 order by a+1 rows between 2  preceding and CURRENT row) as float) as o from t1 group by a, c;
a    sum(b)    o
1    2    2.0
3    4    4.0
3    4    8.0
3    4    12.0
3    4    12.0
5    6    6.0
7    8    8.0
select a, sum(b), sum(sum(b)) over (partition by a rows BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) from
t1 group by a, c;
a    sum(b)    sum(sum(b)) over (partition by a rows between unbounded preceding and current row)
1    2    2
3    4    4
3    4    8
3    4    12
3    4    16
5    6    6
7    8    8
select a, sum(a) over (partition by c order by b range BETWEEN 3 preceding and 4 following), c, b from t1;
a    sum(a) over (partition by c order by b range between 3 preceding and 4 following)    c    b
1    1    1    2
3    3    2    4
5    5    3    6
7    7    4    8
3    3    5    4
3    3    6    4
3    3    7    4
select a, sum(a) over (order by a) from t1;
a    sum(a) over (order by a)
1    1
3    13
3    13
3    13
3    13
5    18
7    25
select a, rank() over (partition by a) from t1;
a    rank() over (partition by a)
1    1
3    1
3    1
3    1
3    1
5    1
7    1
select a, rank() over () from t1;
a    rank() over ()
1    1
3    1
5    1
7    1
3    1
3    1
3    1
select a, sum(a) over (partition by a rows current row) from t1;
a    sum(a) over (partition by a rows current row)
1    1
3    3
3    3
3    3
3    3
5    5
7    7
select c, sum(c) over (order by c range between 1 preceding and 1 following) from t1;
c    sum(c) over (order by c range between 1 preceding and 1 following)
1    3
2    6
3    9
4    12
5    15
6    18
7    13
select c, sum(100) over (order by c range between 1 preceding and 1 following), a, b from t1;
c    sum(100) over (order by c range between 1 preceding and 1 following)    a    b
1    200    1    2
2    300    3    4
3    300    5    6
4    300    7    8
5    300    3    4
6    300    3    4
7    200    3    4
select c, sum(null) over (order by c range between 1 preceding and 1 following), a, b from t1;
c    sum(null) over (order by c range between 1 preceding and 1 following)    a    b
1    null    1    2
2    null    3    4
3    null    5    6
4    null    7    8
5    null    3    4
6    null    3    4
7    null    3    4
select a, b, c, rank() over (partition by a, b order by c) from t1;
a    b    c    rank() over (partition by a, b order by c)
1    2    1    1
3    4    2    1
3    4    5    2
3    4    6    3
3    4    7    4
5    6    3    1
7    8    4    1
select a, c, rank() over(partition by a order by c rows current row) from t1;
a    c    rank() over (partition by a order by c rows current row)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, row_number() over (partition by a) from t1 group by a, c;
a    row_number() over (partition by a)
1    1
3    1
3    2
3    3
3    4
5    1
7    1
select a, c, row_number() over (partition by a order by c) from t1 group by a, c;
a    c    row_number() over (partition by a order by c)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, row_number() over (partition by a order by c) from t1 group by a, c;
a    c    row_number() over (partition by a order by c)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, b, row_number() over (partition by a, c, b) from t1;
a    c    b    row_number() over (partition by a, c, b)
1    1    2    1
3    2    4    1
3    5    4    1
3    6    4    1
3    7    4    1
5    3    6    1
7    4    8    1
select a,  b, row_number() over (partition by a, b) from t1;
a    b    row_number() over (partition by a, b)
1    2    1
3    4    1
3    4    2
3    4    3
3    4    4
5    6    1
7    8    1
select a, sum(b), row_number() over (partition by a +1), row_number() over (partition by c), c from t1 group by a, c;
a    sum(b)    row_number() over (partition by a + 1)    row_number() over (partition by c)    c
1    2    1    1    1
3    4    1    1    2
5    6    1    1    3
7    8    1    1    4
3    4    2    1    5
3    4    3    1    6
3    4    4    1    7
select a, row_number() over (partition by a) from t1;
a    row_number() over (partition by a)
1    1
3    1
3    2
3    3
3    4
5    1
7    1
select a, row_number() over () from t1;
a    row_number() over ()
1    1
3    2
5    3
7    4
3    5
3    6
3    7
select a, b, c, row_number() over (partition by a, b order by c) from t1;
a    b    c    row_number() over (partition by a, b order by c)
1    2    1    1
3    4    2    1
3    4    5    2
3    4    6    3
3    4    7    4
5    6    3    1
7    8    4    1
select a, c, row_number() over(partition by a order by c rows current row) from t1;
a    c    row_number() over (partition by a order by c rows current row)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, dense_rank() over (partition by a) from t1 group by a, c;
a    dense_rank() over (partition by a)
1    1
3    1
3    1
3    1
3    1
5    1
7    1
select a, c, dense_rank() over (partition by a order by c) from t1 group by a, c;
a    c    dense_rank() over (partition by a order by c)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, dense_rank() over (partition by a order by c) from t1 group by a, c;
a    c    dense_rank() over (partition by a order by c)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, b, dense_rank() over (partition by a, c, b) from t1;
a    c    b    dense_rank() over (partition by a, c, b)
1    1    2    1
3    2    4    1
3    5    4    1
3    6    4    1
3    7    4    1
5    3    6    1
7    4    8    1
select a,  b, dense_rank() over (partition by a, b) from t1;
a    b    dense_rank() over (partition by a, b)
1    2    1
3    4    1
3    4    1
3    4    1
3    4    1
5    6    1
7    8    1
select a, sum(b), dense_rank() over (partition by a +1), dense_rank() over (partition by c), c from t1 group by a, c;
a    sum(b)    dense_rank() over (partition by a + 1)    dense_rank() over (partition by c)    c
1    2    1    1    1
3    4    1    1    2
5    6    1    1    3
7    8    1    1    4
3    4    1    1    5
3    4    1    1    6
3    4    1    1    7
select a, dense_rank() over (partition by a) from t1;
a    dense_rank() over (partition by a)
1    1
3    1
3    1
3    1
3    1
5    1
7    1
select a, dense_rank() over () from t1;
a    dense_rank() over ()
1    1
3    1
5    1
7    1
3    1
3    1
3    1
select a, b, c, dense_rank() over (partition by a, b order by c) from t1;
a    b    c    dense_rank() over (partition by a, b order by c)
1    2    1    1
3    4    2    1
3    4    5    2
3    4    6    3
3    4    7    4
5    6    3    1
7    8    4    1
select a, c, dense_rank() over(partition by a order by c rows current row) from t1;
a    c    dense_rank() over (partition by a order by c rows current row)
1    1    1
3    2    1
3    5    2
3    6    3
3    7    4
5    3    1
7    4    1
select a, c, rank() over(order by a), row_number() over(order by a), dense_rank() over(order by a) from t1;
a    c    rank() over (order by a)    row_number() over (order by a)    dense_rank() over (order by a)
1    1    1    1    1
3    2    2    2    2
3    5    2    3    2
3    6    2    4    2
3    7    2    5    2
5    3    6    6    3
7    4    7    7    4
drop table if exists t1;
create table t1 (a int, b decimal(7, 2));
insert into t1 values(1, 12.12), (2, 123.13), (3, 456.66), (4, 1111.34);
select a, sum(b) over (partition by a order by a) from t1;
a    sum(b) over (partition by a order by a)
1    12.12
2    123.13
3    456.66
4    1111.34
drop table if exists wf01;
create table wf01(i int,j int);
insert into wf01 values(1,1);
insert into wf01 values(1,4);
insert into wf01 values(1,2);
insert into wf01 values(1,4);
select * from wf01;
i    j
1    1
1    4
1    2
1    4
select i, j, sum(i+j) over (order by j desc rows unbounded preceding) foo from wf01;
i    j    foo
1    4    5
1    4    10
1    2    13
1    1    15
select i, j, sum(i+j) over (order by j desc rows between 2 preceding and 2 following) as foo from wf01;
i    j    foo
1    4    13
1    4    15
1    2    15
1    1    10
select i, j, sum(i+j) over (order by j desc rows unbounded preceding) foo from wf01 order by foo;
i    j    foo
1    4    5
1    4    10
1    2    13
1    1    15
select i, j, sum(i+j) over (order by j desc rows unbounded preceding) foo from wf01 order by foo desc;
i    j    foo
1    1    15
1    2    13
1    4    10
1    4    5
drop table if exists wf08;
create table wf08(d decimal(10,2), date date);
insert into wf08 values (10.4, '2002-06-09');
insert into wf08 values (20.5, '2002-06-09');
insert into wf08 values (10.4, '2002-06-10');
insert into wf08 values (3,    '2002-06-09');
insert into wf08 values (40.2, '2015-08-01');
insert into wf08 values (40.2, '2002-06-09');
insert into wf08 values (5,    '2015-08-01');
select * from (select rank() over (order by d) as `rank`, d, date from wf08) alias order by `rank`, d, date;
rank    d    date
1    3.00    2002-06-09
2    5.00    2015-08-01
3    10.40    2002-06-09
3    10.40    2002-06-10
5    20.50    2002-06-09
6    40.20    2002-06-09
6    40.20    2015-08-01
select * from (select dense_rank() over (order by d) as `d_rank`, d, date from wf08) alias order by `d_rank`, d, date;
d_rank    d    date
1    3.00    2002-06-09
2    5.00    2015-08-01
3    10.40    2002-06-09
3    10.40    2002-06-10
4    20.50    2002-06-09
5    40.20    2002-06-09
5    40.20    2015-08-01
drop table if exists wf07;
create table wf07 (user_id integer not null, date date);
insert into wf07 values (1, '2002-06-09');
insert into wf07 values (2, '2002-06-09');
insert into wf07 values (1, '2002-06-09');
insert into wf07 values (3, '2002-06-09');
insert into wf07 values (4, '2002-06-09');
insert into wf07 values (4, '2002-06-09');
insert into wf07 values (5, '2002-06-09');
select rank() over () r from wf07;
r
1
1
1
1
1
1
1
select dense_rank() over () r from wf07;
r
1
1
1
1
1
1
1
drop table if exists wf12;
create table wf12(d double);
insert into wf12 values (1.7976931348623157e+307);
insert into wf12 values (1);
select d, sum(d) over (rows between current row and 1 following) from wf12;
d    sum(d) over (rows between current row and 1 following)
1.7976931348623158E307    1.7976931348623158E307
1.0    1.0
drop table if exists wf06;
create table wf06 (id integer, sex char(1));
insert into wf06 values (1, 'm');
insert into wf06 values (2, 'f');
insert into wf06 values (3, 'f');
insert into wf06 values (4, 'f');
insert into wf06 values (5, 'm');
drop table if exists wf07;
create table wf07 (user_id integer not null, date date);
insert into wf07 values (1, '2002-06-09');
insert into wf07 values (2, '2002-06-09');
insert into wf07 values (1, '2002-06-09');
insert into wf07 values (3, '2002-06-09');
insert into wf07 values (4, '2002-06-09');
insert into wf07 values (4, '2002-06-09');
insert into wf07 values (5, '2002-06-09');
select id value, sum(id) over (rows unbounded preceding) from wf06 inner join wf07 on wf07.user_id = wf06.id;
value    sum(id) over (rows unbounded preceding)
1    1
1    2
2    4
3    7
4    11
4    15
5    20 