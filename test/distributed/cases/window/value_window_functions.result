drop table if exists test_value_window;
create table test_value_window (id int, year_col int, revenue decimal(10, 2), category varchar(20));
insert into test_value_window values (1, 2020, 1000.00, 'A'), (2, 2021, 1500.00, 'A'), (3, 2022, 1800.00, 'A'), (4, 2023, 2000.00, 'A'), (5, 2020, 500.00, 'B'), (6, 2021, 600.00, 'B'), (7, 2022, 750.00, 'B');
select id, year_col, revenue, LAG(revenue) over (order by year_col) as prev_revenue from test_value_window where category = 'A';
id	year_col	revenue	prev_revenue
1	2020	1000.00	null
2	2021	1500.00	1000.00
3	2022	1800.00	1500.00
4	2023	2000.00	1800.00
select id, year_col, revenue, LEAD(revenue) over (order by year_col) as next_revenue from test_value_window where category = 'A';
id	year_col	revenue	next_revenue
1	2020	1000.00	1500.00
2	2021	1500.00	1800.00
3	2022	1800.00	2000.00
4	2023	2000.00	null
select id, year_col, revenue, FIRST_VALUE(revenue) over (order by year_col) as first_revenue from test_value_window where category = 'A';
id	year_col	revenue	first_revenue
1	2020	1000.00	1000.00
2	2021	1500.00	1000.00
3	2022	1800.00	1000.00
4	2023	2000.00	1000.00
select id, year_col, revenue, LAST_VALUE(revenue) over (order by year_col rows between unbounded preceding and unbounded following) as last_revenue from test_value_window where category = 'A';
id	year_col	revenue	last_revenue
1	2020	1000.00	2000.00
2	2021	1500.00	2000.00
3	2022	1800.00	2000.00
4	2023	2000.00	2000.00
select id, year_col, revenue, NTH_VALUE(revenue, 1) over (order by year_col) as first_revenue from test_value_window where category = 'A';
id	year_col	revenue	first_revenue
1	2020	1000.00	1000.00
2	2021	1500.00	1000.00
3	2022	1800.00	1000.00
4	2023	2000.00	1000.00
select id, year_col, revenue, category, LAG(revenue) over (partition by category order by year_col) as prev_revenue from test_value_window order by category, year_col;
id	year_col	revenue	category	prev_revenue
1	2020	1000.00	A	null
2	2021	1500.00	A	1000.00
3	2022	1800.00	A	1500.00
4	2023	2000.00	A	1800.00
5	2020	500.00	B	null
6	2021	600.00	B	500.00
7	2022	750.00	B	600.00
select id, category, LAG(category) over (order by id) as prev_category from test_value_window where category = 'A';
id	category	prev_category
1	A	null
2	A	A
3	A	A
4	A	A
select id, category, LEAD(category) over (order by id) as next_category from test_value_window where category = 'A';
id	category	next_category
1	A	A
2	A	A
3	A	A
4	A	null
select id, category, FIRST_VALUE(category) over (order by id) as first_category from test_value_window where category = 'A';
id	category	first_category
1	A	A
2	A	A
3	A	A
4	A	A
select id, category, LAST_VALUE(category) over (order by id rows between unbounded preceding and unbounded following) as last_category from test_value_window where category = 'A';
id	category	last_category
1	A	A
2	A	A
3	A	A
4	A	A
drop table if exists test_null_window;
create table test_null_window (id int, val int);
insert into test_null_window values (1, 100), (2, null), (3, 300), (4, null);
select id, val, LAG(val) over (order by id) as prev_val from test_null_window;
id	val	prev_val
1	100	null
2	null	100
3	300	null
4	null	300
select id, val, LEAD(val) over (order by id) as next_val from test_null_window;
id	val	next_val
1	100	null
2	null	300
3	300	null
4	null	null
select id, val, FIRST_VALUE(val) over (order by id) as first_val from test_null_window;
id	val	first_val
1	100	100
2	null	100
3	300	100
4	null	100
drop table if exists test_null_window;
drop table if exists test_int_types;
create table test_int_types (id int, val_i8 tinyint, val_i16 smallint, val_i32 int, val_i64 bigint);
insert into test_int_types values (1, 10, 100, 1000, 10000), (2, 20, 200, 2000, 20000), (3, 30, 300, 3000, 30000);
select id, LAG(val_i8) over (order by id) as prev_i8 from test_int_types;
id	prev_i8
1	null
2	10
3	20
select id, LAG(val_i64) over (order by id) as prev_i64 from test_int_types;
id	prev_i64
1	null
2	10000
3	20000
select id, LEAD(val_i32) over (order by id) as next_i32 from test_int_types;
id	next_i32
1	2000
2	3000
3	null
drop table if exists test_int_types;
drop table if exists test_float_types;
create table test_float_types (id int, val_f32 float, val_f64 double);
insert into test_float_types values (1, 1.1, 1.11), (2, 2.2, 2.22), (3, 3.3, 3.33);
select id, LAG(val_f32) over (order by id) as prev_f32 from test_float_types;
id	prev_f32
1	null
2	1.1
3	2.2
select id, LEAD(val_f64) over (order by id) as next_f64 from test_float_types;
id	next_f64
1	2.22
2	3.33
3	null
drop table if exists test_float_types;
drop role if exists lag;
drop role if exists lead;
drop table if exists test_value_window;
