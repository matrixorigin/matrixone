select * from plugin_exec('cat', '[1,2,3]') as f;
internal error: command is empty
select * from plugin_exec(cast('"cat"' as json), '[1,2,3]') as f;
internal error: command is a JSON array
select * from plugin_exec('["cat"]', '[1,2,3]') as f;
result
1
2
3
select * from plugin_exec('["cat"]', '["1","2","3"]') as f;
result
"1"
"2"
"3"
select * from plugin_exec(cast('["cat"]' as json), '["a","b","c"]') as f;
result
"a"
"b"
"c"
select * from plugin_exec(cast('["cat"]' as json), '["a","b",null]') as f;
result
"a"
"b"
null
select * from plugin_exec('["cat"]', '[false,true,null]') as f;
result
false
true
null
select json_extract(result, "$.id") from plugin_exec('["cat"]', '[{"id":1},{"id":2},{"id":3}]') as f;
json_extract(result, $.id)
1
2
3
select * from plugin_exec('["cat"]', cast('file:///$resources/plugin/result.json' as datalink)) as f;
result
{"chunk": 0, "e": "[1.1, 2.2, 3.3]", "t": "text0"}
{"chunk": "1", "e": "[2.5, 3.5, 4.5]", "t": "text1"}
{"chunk": "2", "e": "[9.1, 8.2, 7.3]", "t": "text2"}
select json_extract(result, "$.chunk"), json_extract(result, "$.e") from plugin_exec('["cat"]', cast('file:///$resources/plugin/multistream.json?offset=0&size=155' as datalink) ) as f;
json_extract(result, $.chunk)    json_extract(result, $.e)
0    "[1.1, 2.2, 3.3]"
"1"    "[2.5, 3.5, 4.5]"
"2"    "[9.1, 8.2, 7.3]"
select json_extract(result, "$.chunk"), json_extract(result, "$.e") from plugin_exec('["cat"]', cast('file:///$resources/plugin/multistream.json?offset=155&size=164' as datalink) ) as f;
json_extract(result, $.chunk)    json_extract(result, $.e)
3    "[10.1, 20.2, 30.3]"
"4"    "[20.5, 30.5, 40.5]"
"5"    "[90.1, 80.2, 70.3]"
create table t1 (chunk int, e vecf32(3));
insert into t1 select json_unquote(json_extract(result, "$.chunk")), json_unquote(json_extract(result, "$.e"))
from plugin_exec('["cat"]', cast('file:///$resources/plugin/result.json' as datalink)) as f;
select * from t1;
chunk    e
0    [1.1, 2.2, 3.3]
1    [2.5, 3.5, 4.5]
2    [9.1, 8.2, 7.3]
truncate t1;
insert into t1 select json_unquote(json_extract(result, "$.chunk")), json_unquote(json_extract(result, "$.e"))
from plugin_exec('["cat"]', cast('file:///$resources/plugin/multistream.json?offset=0&size=155' as datalink) ) as f;
select * from t1;
chunk    e
0    [1.1, 2.2, 3.3]
1    [2.5, 3.5, 4.5]
2    [9.1, 8.2, 7.3]
insert into t1 select json_unquote(json_extract(result, "$.chunk")), json_unquote(json_extract(result, "$.e"))
from plugin_exec('["cat"]', cast('file:///$resources/plugin/multistream.json?offset=155&size=164' as datalink) ) as f;
select * from t1;
chunk    e
0    [1.1, 2.2, 3.3]
1    [2.5, 3.5, 4.5]
2    [9.1, 8.2, 7.3]
3    [10.1, 20.2, 30.3]
4    [20.5, 30.5, 40.5]
5    [90.1, 80.2, 70.3]
drop table t1;
create stage llmstage URL='file:///$resources/plugin/';
create table src (pkey int primary key, dlink datalink);
create table embed (pkey int, chunk int, e vecf32(3), t varchar);
insert into src values
(0, 'stage://llmstage/multistream.json?offset=0&size=155'),
(1, 'stage://llmstage/multistream.json?offset=155&size=164');
insert into embed select src.pkey, json_unquote(json_extract(f.result, "$.chunk")),
json_unquote(json_extract(f.result, "$.e")), json_unquote(json_extract(f.result, "$.t"))
from src CROSS APPLY plugin_exec('["cat"]', src.dlink) as f;
select * from embed;
pkey    chunk    e    t
0    0    [1.1, 2.2, 3.3]    text0
0    1    [2.5, 3.5, 4.5]    text1
0    2    [9.1, 8.2, 7.3]    text2
1    3    [10.1, 20.2, 30.3]    text3
1    4    [20.5, 30.5, 40.5]    text4
1    5    [90.1, 80.2, 70.3]    text5
drop stage llmstage;
drop table src;
drop table embed;
select * from plugin_exec('["python3", "$resources/plugin/ask.py", "index_table"]', 'this is question to LLM') as f;
result
"this is answer from LLM with index table name = index_table. Question: this is question to LLM"
