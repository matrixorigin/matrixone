drop table if exists export_format_test;
CREATE TABLE export_format_test (
id INT NOT NULL,
name VARCHAR(50),
age INT,
salary DECIMAL(10,2),
is_active BOOL,
created_at DATETIME,
PRIMARY KEY (id)
);
insert into export_format_test values
(1, 'Alice', 30, 50000.00, true, '2023-01-15 10:30:00'),
(2, 'Bob', 25, 45000.50, true, '2023-02-20 14:45:00'),
(3, 'Charlie', 35, 60000.75, false, '2023-03-10 09:15:00'),
(4, 'Diana', 28, 55000.25, true, '2023-04-05 16:00:00'),
(5, 'Eve', 32, 52000.00, false, '2023-05-12 11:30:00');
drop table if exists export_types_test;
CREATE TABLE export_types_test (
id INT NOT NULL,
tiny_val TINYINT,
small_val SMALLINT,
big_val BIGINT,
float_val FLOAT,
double_val DOUBLE,
date_val DATE,
time_val TIME,
timestamp_val TIMESTAMP,
text_val TEXT,
json_val JSON,
uuid_val UUID,
PRIMARY KEY (id)
);
insert into export_types_test values
(1, 127, 32767, 9223372036854775807, 3.14, 3.141592653589793, '2023-01-15', '10:30:00', '2023-01-15 10:30:00', 'Hello World', '{"key": "value"}', '550e8400-e29b-41d4-a716-446655440000'),
(2, -128, -32768, -9223372036854775808, -3.14, -3.141592653589793, '2023-12-31', '23:59:59', '2023-12-31 23:59:59', 'Test Text', '{"array": [1,2,3]}', '6ba7b810-9dad-11d1-80b4-00c04fd430c8');
drop table if exists export_null_test;
CREATE TABLE export_null_test (
id INT NOT NULL,
nullable_int INT,
nullable_str VARCHAR(50),
nullable_decimal DECIMAL(10,2),
PRIMARY KEY (id)
);
insert into export_null_test values
(1, 100, 'has value', 99.99),
(2, NULL, NULL, NULL),
(3, 200, 'another value', NULL),
(4, NULL, 'only string', 50.00);
drop table if exists export_special_chars;
CREATE TABLE export_special_chars (
id INT NOT NULL,
content VARCHAR(200),
PRIMARY KEY (id)
);
insert into export_special_chars values
(1, 'normal text'),
(2, 'text with "quotes"'),
(3, 'text with ''single quotes'''),
(4, 'text,with,commas'),
(5, 'text	with	tabs'),
(6, 'mixed "quotes", commas');
drop table if exists export_empty_test;
CREATE TABLE export_empty_test (
id INT NOT NULL,
name VARCHAR(50),
PRIMARY KEY (id)
);
drop stage if exists export_test_stage;
create stage export_test_stage URL= 'file:///$resources/into_outfile/stage';
select * from export_format_test into outfile 'stage://export_test_stage/test_default.csv';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_lower.csv' format 'csv';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_upper.csv' format 'CSV';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_mixed.csv' format 'Csv';
select * from export_format_test into outfile 'stage://export_test_stage/test_jsonline_lower.jsonl' format 'jsonline';
select * from export_format_test into outfile 'stage://export_test_stage/test_jsonline_upper.jsonl' format 'JSONLINE';
select * from export_format_test into outfile 'stage://export_test_stage/test_jsonline_mixed.jsonl' format 'JsonLine';
select * from export_format_test into outfile 'stage://export_test_stage/test_parquet_lower.parquet' format 'parquet';
select * from export_format_test into outfile 'stage://export_test_stage/test_parquet_upper.parquet' format 'PARQUET';
select * from export_format_test into outfile 'stage://export_test_stage/test_parquet_mixed.parquet' format 'Parquet';
select * from export_format_test into outfile 'stage://export_test_stage/test_infer_jsonl.jsonl';
select * from export_format_test into outfile 'stage://export_test_stage/test_infer_jsonline.jsonline';
select * from export_format_test into outfile 'stage://export_test_stage/test_infer_ndjson.ndjson';
select * from export_format_test into outfile 'stage://export_test_stage/test_infer_parquet.parquet';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_bytes_%d.csv' format 'csv' splitsize '1048576';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_k_lower_%d.csv' format 'csv' splitsize '100k';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_k_upper_%d.csv' format 'csv' splitsize '100K';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_m_lower_%d.csv' format 'csv' splitsize '1m';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_m_upper_%d.csv' format 'csv' splitsize '1M';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_g_lower_%d.csv' format 'csv' splitsize '1g';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_g_upper_%d.csv' format 'csv' splitsize '1G';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_d_%d.csv' format 'csv' splitsize '1M';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_05d_%05d.csv' format 'csv' splitsize '1M';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_jsonline_%d.jsonl' format 'jsonline' splitsize '1M';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_parquet_%d.parquet' format 'parquet' splitsize '1M';
select * from export_format_test into outfile 'stage://export_test_stage/test_split_parquet_05d_%05d.parquet' format 'parquet' splitsize '1M';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_tab.csv' format 'csv' fields terminated by '\t';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_enclosed.csv' format 'csv' fields enclosed by '"';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_lines.csv' format 'csv' lines terminated by '\r\n';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_no_header.csv' format 'csv' header 'false';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_with_header.csv' format 'csv' header 'true';
select * from export_format_test into outfile 'stage://export_test_stage/test_csv_all_opts.csv' format 'csv' fields terminated by '|' enclosed by '"' lines terminated by '\n' header 'true';
select * from export_types_test into outfile 'stage://export_test_stage/test_types_csv.csv' format 'csv';
select * from export_types_test into outfile 'stage://export_test_stage/test_types_jsonline.jsonl' format 'jsonline';
select * from export_types_test into outfile 'stage://export_test_stage/test_types_parquet.parquet' format 'parquet';
select * from export_null_test into outfile 'stage://export_test_stage/test_null_csv.csv' format 'csv';
select * from export_null_test into outfile 'stage://export_test_stage/test_null_jsonline.jsonl' format 'jsonline';
select * from export_null_test into outfile 'stage://export_test_stage/test_null_parquet.parquet' format 'parquet';
select * from export_special_chars into outfile 'stage://export_test_stage/test_special_csv.csv' format 'csv' fields enclosed by '"';
select * from export_special_chars into outfile 'stage://export_test_stage/test_special_jsonline.jsonl' format 'jsonline';
select * from export_empty_test into outfile 'stage://export_test_stage/test_empty_csv.csv' format 'csv';
select * from export_empty_test into outfile 'stage://export_test_stage/test_empty_jsonline.jsonl' format 'jsonline';
select * from export_empty_test into outfile 'stage://export_test_stage/test_empty_parquet.parquet' format 'parquet';
select * from export_format_test where age > 30 into outfile 'stage://export_test_stage/test_where.csv' format 'csv';
select * from export_format_test order by salary desc into outfile 'stage://export_test_stage/test_orderby.csv' format 'csv';
select * from export_format_test limit 3 into outfile 'stage://export_test_stage/test_limit.csv' format 'csv';
select id, name, salary from export_format_test into outfile 'stage://export_test_stage/test_columns.csv' format 'csv';
select id as employee_id, name as employee_name from export_format_test into outfile 'stage://export_test_stage/test_alias.csv' format 'csv';
select id, name, salary * 12 as annual_salary from export_format_test into outfile 'stage://export_test_stage/test_expr.csv' format 'csv';
drop table if exists export_verify;
CREATE TABLE export_verify (
id INT NOT NULL,
name VARCHAR(50),
age INT,
salary DECIMAL(10,2),
is_active BOOL,
created_at DATETIME,
PRIMARY KEY (id)
);
load data infile 'stage://export_test_stage/test_default.csv' into table export_verify fields terminated by ',' ignore 1 lines;
select * from export_verify order by id;
â¤ id[4,32,0]  Â¦  name[12,-1,0]  Â¦  age[4,32,0]  Â¦  salary[3,10,2]  Â¦  is_active[12,4,0]  Â¦  created_at[93,64,0]  ğ„€
1  Â¦  Alice  Â¦  30  Â¦  50000.00  Â¦  true  Â¦  2023-01-15 10:30:00  ğ„€
2  Â¦  Bob  Â¦  25  Â¦  45000.50  Â¦  true  Â¦  2023-02-20 14:45:00  ğ„€
3  Â¦  Charlie  Â¦  35  Â¦  60000.75  Â¦  false  Â¦  2023-03-10 09:15:00  ğ„€
4  Â¦  Diana  Â¦  28  Â¦  55000.25  Â¦  true  Â¦  2023-04-05 16:00:00  ğ„€
5  Â¦  Eve  Â¦  32  Â¦  52000.00  Â¦  false  Â¦  2023-05-12 11:30:00
truncate table export_verify;
load data infile 'stage://export_test_stage/test_csv_tab.csv' into table export_verify fields terminated by '\t' ignore 1 lines;
select * from export_verify order by id;
â¤ id[4,32,0]  Â¦  name[12,-1,0]  Â¦  age[4,32,0]  Â¦  salary[3,10,2]  Â¦  is_active[12,4,0]  Â¦  created_at[93,64,0]  ğ„€
1  Â¦  Alice  Â¦  30  Â¦  50000.00  Â¦  true  Â¦  2023-01-15 10:30:00  ğ„€
2  Â¦  Bob  Â¦  25  Â¦  45000.50  Â¦  true  Â¦  2023-02-20 14:45:00  ğ„€
3  Â¦  Charlie  Â¦  35  Â¦  60000.75  Â¦  false  Â¦  2023-03-10 09:15:00  ğ„€
4  Â¦  Diana  Â¦  28  Â¦  55000.25  Â¦  true  Â¦  2023-04-05 16:00:00  ğ„€
5  Â¦  Eve  Â¦  32  Â¦  52000.00  Â¦  false  Â¦  2023-05-12 11:30:00
truncate table export_verify;
load data infile 'stage://export_test_stage/test_csv_no_header.csv' into table export_verify fields terminated by ',';
select * from export_verify order by id;
â¤ id[4,32,0]  Â¦  name[12,-1,0]  Â¦  age[4,32,0]  Â¦  salary[3,10,2]  Â¦  is_active[12,4,0]  Â¦  created_at[93,64,0]  ğ„€
1  Â¦  Alice  Â¦  30  Â¦  50000.00  Â¦  true  Â¦  2023-01-15 10:30:00  ğ„€
2  Â¦  Bob  Â¦  25  Â¦  45000.50  Â¦  true  Â¦  2023-02-20 14:45:00  ğ„€
3  Â¦  Charlie  Â¦  35  Â¦  60000.75  Â¦  false  Â¦  2023-03-10 09:15:00  ğ„€
4  Â¦  Diana  Â¦  28  Â¦  55000.25  Â¦  true  Â¦  2023-04-05 16:00:00  ğ„€
5  Â¦  Eve  Â¦  32  Â¦  52000.00  Â¦  false  Â¦  2023-05-12 11:30:00
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_xml.txt' format 'xml';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid format, must be csv, jsonline or parquet at line 1 column 107 near " 'xml';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_json.txt' format 'json';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid format, must be csv, jsonline or parquet at line 1 column 109 near " 'json';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_txt.txt' format 'txt';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid format, must be csv, jsonline or parquet at line 1 column 107 near " 'txt';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_empty.txt' format '';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid format, must be csv, jsonline or parquet at line 1 column 106 near " '';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_num.txt' format '123';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid format, must be csv, jsonline or parquet at line 1 column 107 near " '123';";
select * from export_format_test into outfile 'stage://export_test_stage/test_mismatch1.csv' format 'jsonline';
internal error: format 'jsonline' does not match file suffix '.csv'
select * from export_format_test into outfile 'stage://export_test_stage/test_mismatch2.csv' format 'parquet';
internal error: format 'parquet' does not match file suffix '.csv'
select * from export_format_test into outfile 'stage://export_test_stage/test_mismatch3.jsonl' format 'csv';
internal error: format 'csv' does not match file suffix '.jsonl'
select * from export_format_test into outfile 'stage://export_test_stage/test_mismatch4.parquet' format 'csv';
internal error: format 'csv' does not match file suffix '.parquet'
select * from export_format_test into outfile 'stage://export_test_stage/test_mismatch5.parquet' format 'jsonline';
internal error: format 'jsonline' does not match file suffix '.parquet'
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_unit_%d.csv' format 'csv' splitsize '100X';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid splitsize format: internal error: invalid size value: strconv.ParseUint: parsing "100X": invalid syntax at line 1 column 128 near " '100X';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_neg_%d.csv' format 'csv' splitsize '-100M';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid splitsize format: internal error: invalid size value: strconv.ParseUint: parsing "-100": invalid syntax at line 1 column 128 near " '-100M';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_empty_%d.csv' format 'csv' splitsize '';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid splitsize format: internal error: empty size string at line 1 column 125 near " '';";
select * from export_format_test into outfile 'stage://export_test_stage/test_invalid_nan_%d.csv' format 'csv' splitsize 'abc';
SQL parser error: You have an error in your SQL syntax; check the manual that corresponds to your MatrixOne server version for the right syntax to use. invalid splitsize format: internal error: invalid size value: strconv.ParseUint: parsing "abc": invalid syntax at line 1 column 126 near " 'abc';";
select * from export_format_test into outfile 'stage://export_test_stage/test_split_zero.csv' format 'csv' splitsize '0';
select * from export_format_test into outfile 'stage://export_test_stage/test_very_long_filename_that_is_quite_long_indeed_for_testing_purposes.csv' format 'csv';
select * from export_format_test where id = 1 into outfile 'stage://export_test_stage/test_single_row.csv' format 'csv';
select name from export_format_test into outfile 'stage://export_test_stage/test_single_col.csv' format 'csv';
select nullable_int, nullable_str, nullable_decimal from export_null_test where id = 2 into outfile 'stage://export_test_stage/test_all_null_row.csv' format 'csv';
drop table if exists export_format_test;
drop table if exists export_types_test;
drop table if exists export_null_test;
drop table if exists export_special_chars;
drop table if exists export_empty_test;
drop table if exists export_verify;
drop stage if exists export_test_stage;
