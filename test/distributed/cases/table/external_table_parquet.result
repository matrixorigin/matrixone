drop database if exists ext_parquet_db;
create database ext_parquet_db;
use ext_parquet_db;
drop table if exists ext_supported_types;
create external table ext_supported_types (
int32_col INT,
int64_col BIGINT,
uint32_col INT UNSIGNED,
float32_col FLOAT,
float64_col DOUBLE,
string_col VARCHAR(255),
bool_col BOOL,
date_col DATE,
time_col TIME
) infile{"filepath"='$resources/parquet/supported_types.parquet', "format"='parquet'};
select int32_col, int64_col, uint32_col, float32_col, float64_col, string_col, bool_col, date_col, time_col from ext_supported_types;
â¤ int32_col[4,32,0]  Â¦  int64_col[-5,64,0]  Â¦  uint32_col[4,32,0]  Â¦  float32_col[7,24,0]  Â¦  float64_col[8,54,0]  Â¦  string_col[12,-1,0]  Â¦  bool_col[-7,1,0]  Â¦  date_col[91,64,0]  Â¦  time_col[92,64,0]  ğ„€
1  Â¦  10000000000  Â¦  4000000000  Â¦  1.1  Â¦  1.111111111  Â¦  Matrix  Â¦  1  Â¦  2023-01-01  Â¦  10:00:00  ğ„€
2  Â¦  20000000000  Â¦  4100000000  Â¦  2.2  Â¦  2.222222222  Â¦  Origin  Â¦  0  Â¦  2024-05-20  Â¦  15:30:45  ğ„€
3  Â¦  30000000000  Â¦  4200000000  Â¦  3.3  Â¦  3.333333333  Â¦  One  Â¦  1  Â¦  2025-12-31  Â¦  23:59:59
select count(*) from ext_supported_types;
â¤ count(*)[-5,64,0]  ğ„€
3
drop table if exists ext_iris;
create external table ext_iris (
`sepal.length` double,
`sepal.width` double,
`petal.length` double,
`petal.width` double,
`variety` varchar(20)
) infile{"filepath"='$resources/parquet/Iris.parquet', "format"='parquet'};
select count(*) from ext_iris;
â¤ count(*)[-5,64,0]  ğ„€
150
select variety, count(*) as cnt from ext_iris group by variety order by variety;
â¤ variety[12,-1,0]  Â¦  cnt[-5,64,0]  ğ„€
Setosa  Â¦  50  ğ„€
Versicolor  Â¦  50  ğ„€
Virginica  Â¦  50
select * from ext_iris where `sepal.length` > 7.0 order by `sepal.length` limit 5;
â¤ sepal.length[8,54,0]  Â¦  sepal.width[8,54,0]  Â¦  petal.length[8,54,0]  Â¦  petal.width[8,54,0]  Â¦  variety[12,-1,0]  ğ„€
7.1  Â¦  3.0  Â¦  5.9  Â¦  2.1  Â¦  Virginica  ğ„€
7.2  Â¦  3.0  Â¦  5.8  Â¦  1.6  Â¦  Virginica  ğ„€
7.2  Â¦  3.6  Â¦  6.1  Â¦  2.5  Â¦  Virginica  ğ„€
7.2  Â¦  3.2  Â¦  6.0  Â¦  1.8  Â¦  Virginica  ğ„€
7.3  Â¦  2.9  Â¦  6.3  Â¦  1.8  Â¦  Virginica
drop table if exists ext_none;
create external table ext_none (
id BIGINT,
name VARCHAR(100),
value DOUBLE,
status BOOL
) infile{"filepath"='$resources/parquet/test_none.parquet', "format"='parquet'};
select 'NONE' as codec, count(*), sum(value) from ext_none;
â¤ codec[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  sum(value)[8,54,0]  ğ„€
NONE  Â¦  9  Â¦  55.35
drop table if exists ext_snappy;
create external table ext_snappy (
id BIGINT,
name VARCHAR(100),
value DOUBLE,
status BOOL
) infile{"filepath"='$resources/parquet/test_snappy.parquet', "format"='parquet'};
select 'SNAPPY' as codec, count(*), sum(value) from ext_snappy;
â¤ codec[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  sum(value)[8,54,0]  ğ„€
SNAPPY  Â¦  9  Â¦  55.35
drop table if exists ext_gzip;
create external table ext_gzip (
id BIGINT,
name VARCHAR(100),
value DOUBLE,
status BOOL
) infile{"filepath"='$resources/parquet/test_gzip.parquet', "format"='parquet'};
select 'GZIP' as codec, count(*), sum(value) from ext_gzip;
â¤ codec[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  sum(value)[8,54,0]  ğ„€
GZIP  Â¦  9  Â¦  55.35
drop table if exists ext_lz4;
create external table ext_lz4 (
id BIGINT,
name VARCHAR(100),
value DOUBLE,
status BOOL
) infile{"filepath"='$resources/parquet/test_lz4.parquet', "format"='parquet'};
select 'LZ4' as codec, count(*), sum(value) from ext_lz4;
â¤ codec[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  sum(value)[8,54,0]  ğ„€
LZ4  Â¦  9  Â¦  55.35
drop table if exists ext_zstd;
create external table ext_zstd (
id BIGINT,
name VARCHAR(100),
value DOUBLE,
status BOOL
) infile{"filepath"='$resources/parquet/test_zstd.parquet', "format"='parquet'};
select 'ZSTD' as codec, count(*), sum(value) from ext_zstd;
â¤ codec[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  sum(value)[8,54,0]  ğ„€
ZSTD  Â¦  9  Â¦  55.35
drop table if exists ext_brotli;
create external table ext_brotli (
id BIGINT,
name VARCHAR(100),
value DOUBLE,
status BOOL
) infile{"filepath"='$resources/parquet/test_brotli.parquet', "format"='parquet'};
select 'BROTLI' as codec, count(*), sum(value) from ext_brotli;
â¤ codec[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  sum(value)[8,54,0]  ğ„€
BROTLI  Â¦  9  Â¦  55.35
drop table if exists ext_v1;
create external table ext_v1 (
id bigint,
user_name varchar(50),
login_time timestamp
) infile{"filepath"='$resources/parquet/test_v1_legacy.parquet', "format"='parquet'};
select * from ext_v1;
â¤ id[-5,64,0]  Â¦  user_name[12,-1,0]  Â¦  login_time[93,64,0]  ğ„€
1  Â¦  Alpha  Â¦  2023-01-01 10:00:00  ğ„€
2  Â¦  Beta  Â¦  2023-05-20 15:30:00  ğ„€
3  Â¦  Gamma  Â¦  2024-01-01 00:00:00
drop table if exists ext_v2;
create external table ext_v2 (
id bigint,
user_name varchar(50),
login_time timestamp
) infile{"filepath"='$resources/parquet/test_v2_modern.parquet', "format"='parquet'};
select * from ext_v2;
â¤ id[-5,64,0]  Â¦  user_name[12,-1,0]  Â¦  login_time[93,64,0]  ğ„€
1  Â¦  Alpha  Â¦  2023-01-01 10:00:00  ğ„€
2  Â¦  Beta  Â¦  2023-05-20 15:30:00  ğ„€
3  Â¦  Gamma  Â¦  2024-01-01 00:00:00
drop table if exists ext_nullable;
create external table ext_nullable (
id BIGINT,
col_nullable_with_null DOUBLE,
col_nullable_no_null VARCHAR(10),
col_not_nullable BIGINT,
col_all_null DOUBLE
) infile{"filepath"='$resources/parquet/nullable_test.parquet', "format"='parquet'};
select count(*) as total_rows,
sum(case when col_nullable_with_null is null then 1 else 0 end) as null_count_col1,
sum(case when col_all_null is null then 1 else 0 end) as null_count_all_null
from ext_nullable;
â¤ total_rows[-5,64,0]  Â¦  null_count_col1[-5,64,0]  Â¦  null_count_all_null[-5,64,0]  ğ„€
5  Â¦  2  Â¦  5
select * from ext_nullable order by id;
â¤ id[-5,64,0]  Â¦  col_nullable_with_null[8,54,0]  Â¦  col_nullable_no_null[12,-1,0]  Â¦  col_not_nullable[-5,64,0]  Â¦  col_all_null[8,54,0]  ğ„€
1  Â¦  10.5  Â¦  A  Â¦  100  Â¦  null  ğ„€
2  Â¦  null  Â¦  B  Â¦  200  Â¦  null  ğ„€
3  Â¦  30.2  Â¦  C  Â¦  300  Â¦  null  ğ„€
4  Â¦  null  Â¦  D  Â¦  400  Â¦  null  ğ„€
5  Â¦  50.1  Â¦  E  Â¦  500  Â¦  null
drop table if exists ext_decimal;
create external table ext_decimal (
dec_p9_s2 DECIMAL(9, 2),
dec_p18_s9 DECIMAL(18, 9),
dec_p38_s0 DECIMAL(38, 0),
dec_p38_s38 DECIMAL(38, 38)
) infile{"filepath"='$resources/parquet/decimal_boundary_test.parquet', "format"='parquet'};
select * from ext_decimal;
â¤ dec_p9_s2[3,9,2]  Â¦  dec_p18_s9[3,18,9]  Â¦  dec_p38_s0[3,39,0]  Â¦  dec_p38_s38[3,38,38]  ğ„€
9999999.99  Â¦  999999999.999999999  Â¦  99999999999999999999999999999999999999  Â¦  1E-38  ğ„€
-9999999.99  Â¦  -999999999.999999999  Â¦  -99999999999999999999999999999999999999  Â¦  -1E-38  ğ„€
0.00  Â¦  1.234567890  Â¦  0  Â¦  null
select dec_p38_s0 from ext_decimal where dec_p38_s0 > 0;
â¤ dec_p38_s0[3,39,0]  ğ„€
99999999999999999999999999999999999999
drop table if exists ext_binary;
create external table ext_binary (
bin_fixed BINARY(10),
bin_var VARBINARY(255),
bin_blob BLOB,
bin_empty VARBINARY(10)
) infile{"filepath"='$resources/parquet/binary_mapping_test.parquet', "format"='parquet'};
select hex(bin_fixed) as fixed_hex, hex(bin_var) as var_hex from ext_binary;
â¤ fixed_hex[12,-1,0]  Â¦  var_hex[12,-1,0]  ğ„€
3132333435  Â¦  68656C6C6F20776F726C64  ğ„€
4142434445  Â¦  6D61747269786F6E65  ğ„€
464748494A  Â¦  70617271756574
select length(bin_fixed) from ext_binary;
â¤ length(bin_fixed)[-5,64,0]  ğ„€
5  ğ„€
5  ğ„€
5
drop table if exists ext_empty;
create external table ext_empty (
id bigint,
name varchar(100)
) infile{"filepath"='$resources/parquet/empty_test.parquet', "format"='parquet'};
select * from ext_empty;
â¤ id[-5,64,0]  Â¦  name[12,-1,0]
select * from ext_iris where variety = 'Setosa' limit 3;
â¤ sepal.length[8,54,0]  Â¦  sepal.width[8,54,0]  Â¦  petal.length[8,54,0]  Â¦  petal.width[8,54,0]  Â¦  variety[12,-1,0]  ğ„€
5.1  Â¦  3.5  Â¦  1.4  Â¦  0.2  Â¦  Setosa  ğ„€
4.9  Â¦  3.0  Â¦  1.4  Â¦  0.2  Â¦  Setosa  ğ„€
4.7  Â¦  3.2  Â¦  1.3  Â¦  0.2  Â¦  Setosa
select variety, avg(`sepal.length`) as avg_sepal_len
from ext_iris
group by variety
having avg(`sepal.length`) > 5.5
order by avg_sepal_len;
â¤ variety[12,-1,0]  Â¦  avg_sepal_len[8,54,0]  ğ„€
Versicolor  Â¦  5.936  ğ„€
Virginica  Â¦  6.587999999999998
select * from ext_iris order by `sepal.length` desc limit 5;
â¤ sepal.length[8,54,0]  Â¦  sepal.width[8,54,0]  Â¦  petal.length[8,54,0]  Â¦  petal.width[8,54,0]  Â¦  variety[12,-1,0]  ğ„€
7.9  Â¦  3.8  Â¦  6.4  Â¦  2.0  Â¦  Virginica  ğ„€
7.7  Â¦  2.6  Â¦  6.9  Â¦  2.3  Â¦  Virginica  ğ„€
7.7  Â¦  2.8  Â¦  6.7  Â¦  2.0  Â¦  Virginica  ğ„€
7.7  Â¦  3.8  Â¦  6.7  Â¦  2.2  Â¦  Virginica  ğ„€
7.7  Â¦  3.0  Â¦  6.1  Â¦  2.3  Â¦  Virginica
select
count(*) as cnt,
sum(`sepal.length`) as sum_val,
avg(`sepal.length`) as avg_val,
min(`sepal.length`) as min_val,
max(`sepal.length`) as max_val
from ext_iris;
â¤ cnt[-5,64,0]  Â¦  sum_val[8,54,0]  Â¦  avg_val[8,54,0]  Â¦  min_val[8,54,0]  Â¦  max_val[8,54,0]  ğ„€
150  Â¦  876.5000000000002  Â¦  5.843333333333335  Â¦  4.3  Â¦  7.9
drop table if exists variety_info;
create table variety_info (
variety varchar(20),
description varchar(100)
);
insert into variety_info values
('Setosa', 'Small flowers'),
('Versicolor', 'Medium flowers'),
('Virginica', 'Large flowers');
select e.variety, v.description, count(*) as cnt
from ext_iris e
join variety_info v on e.variety = v.variety
group by e.variety, v.description
order by e.variety;
â¤ variety[12,-1,0]  Â¦  description[12,-1,0]  Â¦  cnt[-5,64,0]  ğ„€
Setosa  Â¦  Small flowers  Â¦  50  ğ„€
Versicolor  Â¦  Medium flowers  Â¦  50  ğ„€
Virginica  Â¦  Large flowers  Â¦  50
select * from ext_iris
where `sepal.length` > (select avg(`sepal.length`) from ext_iris)
order by `sepal.length`
limit 5;
â¤ sepal.length[8,54,0]  Â¦  sepal.width[8,54,0]  Â¦  petal.length[8,54,0]  Â¦  petal.width[8,54,0]  Â¦  variety[12,-1,0]  ğ„€
5.9  Â¦  3.2  Â¦  4.8  Â¦  1.8  Â¦  Versicolor  ğ„€
5.9  Â¦  3.0  Â¦  4.2  Â¦  1.5  Â¦  Versicolor  ğ„€
5.9  Â¦  3.0  Â¦  5.1  Â¦  1.8  Â¦  Virginica  ğ„€
6.0  Â¦  2.2  Â¦  4.0  Â¦  1.0  Â¦  Versicolor  ğ„€
6.0  Â¦  2.9  Â¦  4.5  Â¦  1.5  Â¦  Versicolor
drop table if exists ext_with_stats;
create external table ext_with_stats (
id BIGINT,
score DOUBLE
) infile{"filepath"='$resources/parquet/with_stats.parquet', "format"='parquet'};
select 'with_stats' as source, count(*), min(id), max(score) from ext_with_stats;
â¤ source[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  min(id)[-5,64,0]  Â¦  max(score)[8,54,0]  ğ„€
with_stats  Â¦  5  Â¦  10  Â¦  95.5
drop table if exists ext_no_stats;
create external table ext_no_stats (
id BIGINT,
score DOUBLE
) infile{"filepath"='$resources/parquet/no_stats.parquet', "format"='parquet'};
select 'no_stats' as source, count(*), min(id), max(score) from ext_no_stats;
â¤ source[12,-1,0]  Â¦  count(*)[-5,64,0]  Â¦  min(id)[-5,64,0]  Â¦  max(score)[8,54,0]  ğ„€
no_stats  Â¦  5  Â¦  10  Â¦  95.5
drop table if exists ext_wide;
create external table ext_wide (
col_0 BIGINT, col_1 DOUBLE, col_2 BIGINT, col_3 DOUBLE, col_4 BIGINT,
col_5 DOUBLE, col_6 BIGINT, col_7 DOUBLE, col_8 BIGINT, col_9 DOUBLE,
col_10 BIGINT, col_11 DOUBLE, col_12 BIGINT, col_13 DOUBLE, col_14 BIGINT,
col_15 DOUBLE, col_16 BIGINT, col_17 DOUBLE, col_18 BIGINT, col_19 DOUBLE,
col_20 BIGINT, col_21 DOUBLE, col_22 BIGINT, col_23 DOUBLE, col_24 BIGINT,
col_25 DOUBLE, col_26 BIGINT, col_27 DOUBLE, col_28 BIGINT, col_29 DOUBLE,
col_30 BIGINT, col_31 DOUBLE, col_32 BIGINT, col_33 DOUBLE, col_34 BIGINT,
col_35 DOUBLE, col_36 BIGINT, col_37 DOUBLE, col_38 BIGINT, col_39 DOUBLE,
col_40 BIGINT, col_41 DOUBLE, col_42 BIGINT, col_43 DOUBLE, col_44 BIGINT,
col_45 DOUBLE, col_46 BIGINT, col_47 DOUBLE, col_48 BIGINT, col_49 DOUBLE,
col_50 BIGINT, col_51 DOUBLE, col_52 BIGINT, col_53 DOUBLE, col_54 BIGINT,
col_55 DOUBLE, col_56 BIGINT, col_57 DOUBLE, col_58 BIGINT, col_59 DOUBLE,
col_60 BIGINT, col_61 DOUBLE, col_62 BIGINT, col_63 DOUBLE, col_64 BIGINT,
col_65 DOUBLE, col_66 BIGINT, col_67 DOUBLE, col_68 BIGINT, col_69 DOUBLE,
col_70 BIGINT, col_71 DOUBLE, col_72 BIGINT, col_73 DOUBLE, col_74 BIGINT,
col_75 DOUBLE, col_76 BIGINT, col_77 DOUBLE, col_78 BIGINT, col_79 DOUBLE,
col_80 BIGINT, col_81 DOUBLE, col_82 BIGINT, col_83 DOUBLE, col_84 BIGINT,
col_85 DOUBLE, col_86 BIGINT, col_87 DOUBLE, col_88 BIGINT, col_89 DOUBLE,
col_90 BIGINT, col_91 DOUBLE, col_92 BIGINT, col_93 DOUBLE, col_94 BIGINT,
col_95 DOUBLE, col_96 BIGINT, col_97 DOUBLE, col_98 BIGINT, col_99 DOUBLE
) infile{"filepath"='$resources/parquet/wide_table_100.parquet', "format"='parquet'};
select count(*) from ext_wide;
â¤ count(*)[-5,64,0]  ğ„€
10
select col_0, col_50, col_99 from ext_wide limit 3;
â¤ col_0[-5,64,0]  Â¦  col_50[-5,64,0]  Â¦  col_99[8,54,0]  ğ„€
8532  Â¦  6030  Â¦  1.9133920123024617  ğ„€
6843  Â¦  5056  Â¦  41.18178009514648  ğ„€
6330  Â¦  5820  Â¦  24.09602999503998
drop table if exists ext_wildcard_v;
create external table ext_wildcard_v (
id bigint,
user_name varchar(50),
login_time timestamp
) infile{"filepath"='$resources/parquet/test_v*.parquet', "format"='parquet'};
select count(*) as total_rows from ext_wildcard_v;
â¤ total_rows[-5,64,0]  ğ„€
6
select * from ext_wildcard_v order by id;
â¤ id[-5,64,0]  Â¦  user_name[12,-1,0]  Â¦  login_time[93,64,0]  ğ„€
1  Â¦  Alpha  Â¦  2023-01-01 10:00:00  ğ„€
1  Â¦  Alpha  Â¦  2023-01-01 10:00:00  ğ„€
2  Â¦  Beta  Â¦  2023-05-20 15:30:00  ğ„€
2  Â¦  Beta  Â¦  2023-05-20 15:30:00  ğ„€
3  Â¦  Gamma  Â¦  2024-01-01 00:00:00  ğ„€
3  Â¦  Gamma  Â¦  2024-01-01 00:00:00
drop table if exists ext_readonly;
create external table ext_readonly (
id BIGINT,
name VARCHAR(100)
) infile{"filepath"='$resources/parquet/test_none.parquet', "format"='parquet'};
insert into ext_readonly values (100, 'test');
invalid input: cannot insert/update/delete from external table
update ext_readonly set name = 'updated' where id = 1;
invalid input: cannot insert/update/delete from external table
delete from ext_readonly where id = 1;
invalid input: cannot insert/update/delete from external table
drop table if exists ext_supported_types;
drop table if exists ext_iris;
drop table if exists ext_none;
drop table if exists ext_snappy;
drop table if exists ext_gzip;
drop table if exists ext_lz4;
drop table if exists ext_zstd;
drop table if exists ext_brotli;
drop table if exists ext_v1;
drop table if exists ext_v2;
drop table if exists ext_nullable;
drop table if exists ext_decimal;
drop table if exists ext_binary;
drop table if exists ext_empty;
drop table if exists variety_info;
drop table if exists ext_with_stats;
drop table if exists ext_no_stats;
drop table if exists ext_wide;
drop table if exists ext_wildcard_v;
drop table if exists ext_readonly;
drop database ext_parquet_db;
