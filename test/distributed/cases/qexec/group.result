drop database if exists qetest;
create database qetest;
use qetest;
create table t (a int, b boolean, b2 tinyint, b3 smallint, b4 int, b5 bigint,
c varchar(100), d decimal(10, 2),
f real, g float,
ts timestamp, dt datetime, dd date,
u uuid,
j json, bin varbinary);
insert into t select
result,
result % 2 = 0, result % 10, result % 100, result % 1000, result,
case when result % 10 = 0 then null else 'foobar' || result || 'zoo' end,
case when result % 10 = 0 then null else result end,
case when result % 10 = 0 then null else result end,
case when result % 10 = 0 then null else result end,
'2021-02-01 11:11:11', '2021-02-01 11:11:11', '2021-02-01',
'11111111-1111-1111-1111-111111111111',
'{"foo": "bar", "zoo": [1, 2, ' || result || ']}',
cast(result as varbinary)
from generate_series(1, 1000000) gt;
select count(*) from t;
â¤ count(*)[-5,64,0]  ğ„€
1000000
insert into t select * from t;
select count(*) from t;
â¤ count(*)[-5,64,0]  ğ„€
2000000
select count(*), count(a),
count(b), count(b2), count(b3), count(b4), count(b5),
count(c), count(d), count(f), count(g),
count(ts), count(dt), count(dd),
count(u), count(j), count(bin),
avg(a),
avg(b2), avg(b3), avg(b4), avg(b5),
avg(d), avg(f), avg(g),
max(a), max(b), max(b2), max(b3), max(b4), max(b5),
max(c), max(d), max(f), max(g),
max(ts), max(dt), max(dd),
max(u), max(bin)
from t;
â¤ count(*)[-5,64,0]  Â¦  count(a)[-5,64,0]  Â¦  count(b)[-5,64,0]  Â¦  count(b2)[-5,64,0]  Â¦  count(b3)[-5,64,0]  Â¦  count(b4)[-5,64,0]  Â¦  count(b5)[-5,64,0]  Â¦  count(c)[-5,64,0]  Â¦  count(d)[-5,64,0]  Â¦  count(f)[-5,64,0]  Â¦  count(g)[-5,64,0]  Â¦  count(ts)[-5,64,0]  Â¦  count(dt)[-5,64,0]  Â¦  count(dd)[-5,64,0]  Â¦  count(u)[-5,64,0]  Â¦  count(j)[-5,64,0]  Â¦  count(bin)[-5,64,0]  Â¦  avg(a)[8,54,0]  Â¦  avg(b2)[8,54,0]  Â¦  avg(b3)[8,54,0]  Â¦  avg(b4)[8,54,0]  Â¦  avg(b5)[8,54,0]  Â¦  avg(d)[3,38,8]  Â¦  avg(f)[8,54,0]  Â¦  avg(g)[8,54,0]  Â¦  max(a)[4,32,0]  Â¦  max(b)[-7,1,0]  Â¦  max(b2)[-6,8,0]  Â¦  max(b3)[5,16,0]  Â¦  max(b4)[4,32,0]  Â¦  max(b5)[-5,64,0]  Â¦  max(c)[12,-1,0]  Â¦  max(d)[3,10,2]  Â¦  max(f)[8,54,0]  Â¦  max(g)[7,24,0]  Â¦  max(ts)[93,64,0]  Â¦  max(dt)[93,64,0]  Â¦  max(dd)[91,64,0]  Â¦  max(u)[12,-1,0]  Â¦  max(bin)[12,196605,0]  ğ„€
2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  1800000  Â¦  1800000  Â¦  1800000  Â¦  1800000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  2000000  Â¦  500000.5  Â¦  4.5  Â¦  49.5  Â¦  499.5  Â¦  500000.5  Â¦  500000.00000000  Â¦  500000.0  Â¦  500000.0  Â¦  1000000  Â¦  1  Â¦  9  Â¦  99  Â¦  999  Â¦  1000000  Â¦  foobar9zoo  Â¦  999999.00  Â¦  999999.0  Â¦  999999.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999999
select count(*), count(distinct a),
count(distinct b), count(distinct b2), count(distinct b3), count(distinct b4), count(distinct b5),
count(distinct c), count(distinct d), count(distinct f), count(distinct g),
count(distinct ts), count(distinct dt), count(distinct dd),
count(distinct u), count(distinct j), count(distinct bin),
avg(distinct a),
avg(distinct b2), avg(distinct b3), avg(distinct b4), avg(distinct b5),
avg(distinct d), avg(distinct f), avg(distinct g),
max(distinct a), max(distinct b), max(distinct b2), max(distinct b3), max(distinct b4), max(distinct b5),
max(distinct c), max(distinct d), max(distinct f), max(distinct g),
max(distinct ts), max(distinct dt), max(distinct dd),
max(distinct u), max(distinct bin)
from t
where a < 1000;
â¤ count(*)[-5,64,0]  Â¦  count(distinct a)[-5,64,0]  Â¦  count(distinct b)[-5,64,0]  Â¦  count(distinct b2)[-5,64,0]  Â¦  count(distinct b3)[-5,64,0]  Â¦  count(distinct b4)[-5,64,0]  Â¦  count(distinct b5)[-5,64,0]  Â¦  count(distinct c)[-5,64,0]  Â¦  count(distinct d)[-5,64,0]  Â¦  count(distinct f)[-5,64,0]  Â¦  count(distinct g)[-5,64,0]  Â¦  count(distinct ts)[-5,64,0]  Â¦  count(distinct dt)[-5,64,0]  Â¦  count(distinct dd)[-5,64,0]  Â¦  count(distinct u)[-5,64,0]  Â¦  count(distinct j)[-5,64,0]  Â¦  count(distinct bin)[-5,64,0]  Â¦  avg(distinct a)[8,54,0]  Â¦  avg(distinct b2)[8,54,0]  Â¦  avg(distinct b3)[8,54,0]  Â¦  avg(distinct b4)[8,54,0]  Â¦  avg(distinct b5)[8,54,0]  Â¦  avg(distinct d)[3,38,8]  Â¦  avg(distinct f)[8,54,0]  Â¦  avg(distinct g)[8,54,0]  Â¦  max(distinct a)[4,32,0]  Â¦  max(distinct b)[-7,1,0]  Â¦  max(distinct b2)[-6,8,0]  Â¦  max(distinct b3)[5,16,0]  Â¦  max(distinct b4)[4,32,0]  Â¦  max(distinct b5)[-5,64,0]  Â¦  max(distinct c)[12,-1,0]  Â¦  max(distinct d)[3,10,2]  Â¦  max(distinct f)[8,54,0]  Â¦  max(distinct g)[7,24,0]  Â¦  max(distinct ts)[93,64,0]  Â¦  max(distinct dt)[93,64,0]  Â¦  max(distinct dd)[91,64,0]  Â¦  max(distinct u)[12,-1,0]  Â¦  max(distinct bin)[12,196605,0]  ğ„€
1998  Â¦  999  Â¦  2  Â¦  10  Â¦  100  Â¦  999  Â¦  999  Â¦  900  Â¦  900  Â¦  900  Â¦  900  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  999  Â¦  999  Â¦  500.0  Â¦  4.5  Â¦  49.5  Â¦  500.0  Â¦  500.0  Â¦  500.00000000  Â¦  500.0  Â¦  500.0  Â¦  999  Â¦  1  Â¦  9  Â¦  99  Â¦  999  Â¦  999  Â¦  foobar9zoo  Â¦  999.00  Â¦  999.0  Â¦  999.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999
select count(*), count(a),
count(b), count(b2), count(b3), count(b4), count(b5),
count(c), count(d), count(f), count(g),
count(ts), count(dt), count(dd),
count(u), count(j), count(bin),
avg(a),
avg(b2), avg(b3), avg(b4), avg(b5),
avg(d), avg(f), avg(g),
max(a), max(b), max(b2), max(b3), max(b4), max(b5),
max(c), max(d), max(f), max(g),
max(ts), max(dt), max(dd),
max(u), max(bin)
from t
group by b2
order by b2
;
â¤ count(*)[-5,64,0]  Â¦  count(a)[-5,64,0]  Â¦  count(b)[-5,64,0]  Â¦  count(b2)[-5,64,0]  Â¦  count(b3)[-5,64,0]  Â¦  count(b4)[-5,64,0]  Â¦  count(b5)[-5,64,0]  Â¦  count(c)[-5,64,0]  Â¦  count(d)[-5,64,0]  Â¦  count(f)[-5,64,0]  Â¦  count(g)[-5,64,0]  Â¦  count(ts)[-5,64,0]  Â¦  count(dt)[-5,64,0]  Â¦  count(dd)[-5,64,0]  Â¦  count(u)[-5,64,0]  Â¦  count(j)[-5,64,0]  Â¦  count(bin)[-5,64,0]  Â¦  avg(a)[8,54,0]  Â¦  avg(b2)[8,54,0]  Â¦  avg(b3)[8,54,0]  Â¦  avg(b4)[8,54,0]  Â¦  avg(b5)[8,54,0]  Â¦  avg(d)[3,38,8]  Â¦  avg(f)[8,54,0]  Â¦  avg(g)[8,54,0]  Â¦  max(a)[4,32,0]  Â¦  max(b)[-7,1,0]  Â¦  max(b2)[-6,8,0]  Â¦  max(b3)[5,16,0]  Â¦  max(b4)[4,32,0]  Â¦  max(b5)[-5,64,0]  Â¦  max(c)[12,-1,0]  Â¦  max(d)[3,10,2]  Â¦  max(f)[8,54,0]  Â¦  max(g)[7,24,0]  Â¦  max(ts)[93,64,0]  Â¦  max(dt)[93,64,0]  Â¦  max(dd)[91,64,0]  Â¦  max(u)[12,-1,0]  Â¦  max(bin)[12,196605,0]  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  0  Â¦  0  Â¦  0  Â¦  0  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  500005.0  Â¦  0.0  Â¦  45.0  Â¦  495.0  Â¦  500005.0  Â¦  null  Â¦  null  Â¦  null  Â¦  1000000  Â¦  1  Â¦  0  Â¦  90  Â¦  990  Â¦  1000000  Â¦  null  Â¦  null  Â¦  null  Â¦  null  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999990  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  499996.0  Â¦  1.0  Â¦  46.0  Â¦  496.0  Â¦  499996.0  Â¦  499996.00000000  Â¦  499996.0  Â¦  499996.0  Â¦  999991  Â¦  0  Â¦  1  Â¦  91  Â¦  991  Â¦  999991  Â¦  foobar999991zoo  Â¦  999991.00  Â¦  999991.0  Â¦  999991.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999991  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  499997.0  Â¦  2.0  Â¦  47.0  Â¦  497.0  Â¦  499997.0  Â¦  499997.00000000  Â¦  499997.0  Â¦  499997.0  Â¦  999992  Â¦  1  Â¦  2  Â¦  92  Â¦  992  Â¦  999992  Â¦  foobar999992zoo  Â¦  999992.00  Â¦  999992.0  Â¦  999992.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999992  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  499998.0  Â¦  3.0  Â¦  48.0  Â¦  498.0  Â¦  499998.0  Â¦  499998.00000000  Â¦  499998.0  Â¦  499998.0  Â¦  999993  Â¦  0  Â¦  3  Â¦  93  Â¦  993  Â¦  999993  Â¦  foobar999993zoo  Â¦  999993.00  Â¦  999993.0  Â¦  999993.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999993  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  499999.0  Â¦  4.0  Â¦  49.0  Â¦  499.0  Â¦  499999.0  Â¦  499999.00000000  Â¦  499999.0  Â¦  499999.0  Â¦  999994  Â¦  1  Â¦  4  Â¦  94  Â¦  994  Â¦  999994  Â¦  foobar999994zoo  Â¦  999994.00  Â¦  999994.0  Â¦  999994.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999994  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  500000.0  Â¦  5.0  Â¦  50.0  Â¦  500.0  Â¦  500000.0  Â¦  500000.00000000  Â¦  500000.0  Â¦  500000.0  Â¦  999995  Â¦  0  Â¦  5  Â¦  95  Â¦  995  Â¦  999995  Â¦  foobar999995zoo  Â¦  999995.00  Â¦  999995.0  Â¦  999995.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999995  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  500001.0  Â¦  6.0  Â¦  51.0  Â¦  501.0  Â¦  500001.0  Â¦  500001.00000000  Â¦  500001.0  Â¦  500001.0  Â¦  999996  Â¦  1  Â¦  6  Â¦  96  Â¦  996  Â¦  999996  Â¦  foobar999996zoo  Â¦  999996.00  Â¦  999996.0  Â¦  999996.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999996  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  500002.0  Â¦  7.0  Â¦  52.0  Â¦  502.0  Â¦  500002.0  Â¦  500002.00000000  Â¦  500002.0  Â¦  500002.0  Â¦  999997  Â¦  0  Â¦  7  Â¦  97  Â¦  997  Â¦  999997  Â¦  foobar999997zoo  Â¦  999997.00  Â¦  999997.0  Â¦  999997.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999997  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  500003.0  Â¦  8.0  Â¦  53.0  Â¦  503.0  Â¦  500003.0  Â¦  500003.00000000  Â¦  500003.0  Â¦  500003.0  Â¦  999998  Â¦  1  Â¦  8  Â¦  98  Â¦  998  Â¦  999998  Â¦  foobar999998zoo  Â¦  999998.00  Â¦  999998.0  Â¦  999998.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999998  ğ„€
200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  200000  Â¦  500004.0  Â¦  9.0  Â¦  54.0  Â¦  504.0  Â¦  500004.0  Â¦  500004.00000000  Â¦  500004.0  Â¦  500004.0  Â¦  999999  Â¦  0  Â¦  9  Â¦  99  Â¦  999  Â¦  999999  Â¦  foobar9zoo  Â¦  999999.00  Â¦  999999.0  Â¦  999999.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999999
select count(*), count(distinct a),
count(distinct b), count(distinct b2), count(distinct b3), count(distinct b4), count(distinct b5),
count(distinct c), count(distinct d), count(distinct f), count(distinct g),
count(distinct ts), count(distinct dt), count(distinct dd),
count(distinct u), count(distinct j), count(distinct bin),
avg(distinct a),
avg(distinct b2), avg(distinct b3), avg(distinct b4), avg(distinct b5),
avg(distinct d), avg(distinct f), avg(distinct g),
max(distinct a), max(distinct b), max(distinct b2), max(distinct b3), max(distinct b4), max(distinct b5),
max(distinct c), max(distinct d), max(distinct f), max(distinct g),
max(distinct ts), max(distinct dt), max(distinct dd),
max(distinct u), max(distinct bin)
from t
where a < 1000
group by b2
order by b2
;
â¤ count(*)[-5,64,0]  Â¦  count(distinct a)[-5,64,0]  Â¦  count(distinct b)[-5,64,0]  Â¦  count(distinct b2)[-5,64,0]  Â¦  count(distinct b3)[-5,64,0]  Â¦  count(distinct b4)[-5,64,0]  Â¦  count(distinct b5)[-5,64,0]  Â¦  count(distinct c)[-5,64,0]  Â¦  count(distinct d)[-5,64,0]  Â¦  count(distinct f)[-5,64,0]  Â¦  count(distinct g)[-5,64,0]  Â¦  count(distinct ts)[-5,64,0]  Â¦  count(distinct dt)[-5,64,0]  Â¦  count(distinct dd)[-5,64,0]  Â¦  count(distinct u)[-5,64,0]  Â¦  count(distinct j)[-5,64,0]  Â¦  count(distinct bin)[-5,64,0]  Â¦  avg(distinct a)[8,54,0]  Â¦  avg(distinct b2)[8,54,0]  Â¦  avg(distinct b3)[8,54,0]  Â¦  avg(distinct b4)[8,54,0]  Â¦  avg(distinct b5)[8,54,0]  Â¦  avg(distinct d)[3,38,8]  Â¦  avg(distinct f)[8,54,0]  Â¦  avg(distinct g)[8,54,0]  Â¦  max(distinct a)[4,32,0]  Â¦  max(distinct b)[-7,1,0]  Â¦  max(distinct b2)[-6,8,0]  Â¦  max(distinct b3)[5,16,0]  Â¦  max(distinct b4)[4,32,0]  Â¦  max(distinct b5)[-5,64,0]  Â¦  max(distinct c)[12,-1,0]  Â¦  max(distinct d)[3,10,2]  Â¦  max(distinct f)[8,54,0]  Â¦  max(distinct g)[7,24,0]  Â¦  max(distinct ts)[93,64,0]  Â¦  max(distinct dt)[93,64,0]  Â¦  max(distinct dd)[91,64,0]  Â¦  max(distinct u)[12,-1,0]  Â¦  max(distinct bin)[12,196605,0]  ğ„€
198  Â¦  99  Â¦  1  Â¦  1  Â¦  10  Â¦  99  Â¦  99  Â¦  0  Â¦  0  Â¦  0  Â¦  0  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  99  Â¦  99  Â¦  500.0  Â¦  0.0  Â¦  45.0  Â¦  500.0  Â¦  500.0  Â¦  null  Â¦  null  Â¦  null  Â¦  990  Â¦  1  Â¦  0  Â¦  90  Â¦  990  Â¦  990  Â¦  null  Â¦  null  Â¦  null  Â¦  null  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  990  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  496.0  Â¦  1.0  Â¦  46.0  Â¦  496.0  Â¦  496.0  Â¦  496.00000000  Â¦  496.0  Â¦  496.0  Â¦  991  Â¦  0  Â¦  1  Â¦  91  Â¦  991  Â¦  991  Â¦  foobar991zoo  Â¦  991.00  Â¦  991.0  Â¦  991.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  991  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  497.0  Â¦  2.0  Â¦  47.0  Â¦  497.0  Â¦  497.0  Â¦  497.00000000  Â¦  497.0  Â¦  497.0  Â¦  992  Â¦  1  Â¦  2  Â¦  92  Â¦  992  Â¦  992  Â¦  foobar992zoo  Â¦  992.00  Â¦  992.0  Â¦  992.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  992  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  498.0  Â¦  3.0  Â¦  48.0  Â¦  498.0  Â¦  498.0  Â¦  498.00000000  Â¦  498.0  Â¦  498.0  Â¦  993  Â¦  0  Â¦  3  Â¦  93  Â¦  993  Â¦  993  Â¦  foobar993zoo  Â¦  993.00  Â¦  993.0  Â¦  993.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  993  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  499.0  Â¦  4.0  Â¦  49.0  Â¦  499.0  Â¦  499.0  Â¦  499.00000000  Â¦  499.0  Â¦  499.0  Â¦  994  Â¦  1  Â¦  4  Â¦  94  Â¦  994  Â¦  994  Â¦  foobar994zoo  Â¦  994.00  Â¦  994.0  Â¦  994.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  994  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  500.0  Â¦  5.0  Â¦  50.0  Â¦  500.0  Â¦  500.0  Â¦  500.00000000  Â¦  500.0  Â¦  500.0  Â¦  995  Â¦  0  Â¦  5  Â¦  95  Â¦  995  Â¦  995  Â¦  foobar995zoo  Â¦  995.00  Â¦  995.0  Â¦  995.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  995  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  501.0  Â¦  6.0  Â¦  51.0  Â¦  501.0  Â¦  501.0  Â¦  501.00000000  Â¦  501.0  Â¦  501.0  Â¦  996  Â¦  1  Â¦  6  Â¦  96  Â¦  996  Â¦  996  Â¦  foobar996zoo  Â¦  996.00  Â¦  996.0  Â¦  996.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  996  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  502.0  Â¦  7.0  Â¦  52.0  Â¦  502.0  Â¦  502.0  Â¦  502.00000000  Â¦  502.0  Â¦  502.0  Â¦  997  Â¦  0  Â¦  7  Â¦  97  Â¦  997  Â¦  997  Â¦  foobar997zoo  Â¦  997.00  Â¦  997.0  Â¦  997.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  997  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  503.0  Â¦  8.0  Â¦  53.0  Â¦  503.0  Â¦  503.0  Â¦  503.00000000  Â¦  503.0  Â¦  503.0  Â¦  998  Â¦  1  Â¦  8  Â¦  98  Â¦  998  Â¦  998  Â¦  foobar998zoo  Â¦  998.00  Â¦  998.0  Â¦  998.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  998  ğ„€
200  Â¦  100  Â¦  1  Â¦  1  Â¦  10  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  100  Â¦  1  Â¦  1  Â¦  1  Â¦  1  Â¦  100  Â¦  100  Â¦  504.0  Â¦  9.0  Â¦  54.0  Â¦  504.0  Â¦  504.0  Â¦  504.00000000  Â¦  504.0  Â¦  504.0  Â¦  999  Â¦  0  Â¦  9  Â¦  99  Â¦  999  Â¦  999  Â¦  foobar9zoo  Â¦  999.00  Â¦  999.0  Â¦  999.0  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01 11:11:11  Â¦  2021-02-01  Â¦  11111111-1111-1111-1111-111111111111  Â¦  999
select count(a), sum(d), sum(f) from (
select count(*), a, sum(d) as d, sum(f) as f from t group by a
) tmp;
â¤ count(a)[-5,64,0]  Â¦  sum(d)[3,38,2]  Â¦  sum(f)[8,54,0]  ğ„€
1000000  Â¦  900000000000.00  Â¦  9.0E11
select count(a), sum(d), sum(f) from (
select count(*), a, sum(d) as d, sum(f) as f from t group by a
having a % 100 > 95
) tmp;
â¤ count(a)[-5,64,0]  Â¦  sum(d)[3,38,2]  Â¦  sum(f)[8,54,0]  ğ„€
40000  Â¦  40003800000.00  Â¦  4.00038E10
select count(*) from (select a, b, c from t group by a, b, c) tmpt;
â¤ count(*)[-5,64,0]  ğ„€
1000000
select sum(a), max(c), avg(d), avg(f) from (select a, c, avg(d) as d, avg(f) as f from t group by a, c) tmpt;
â¤ sum(a)[-5,64,0]  Â¦  max(c)[12,-1,0]  Â¦  avg(d)[3,38,12]  Â¦  avg(f)[8,54,0]  ğ„€
500000500000  Â¦  foobar9zoo  Â¦  500000.000000000000  Â¦  500000.0
select count(a), sum(d), sum(f) from (
select count(*), a, sum(distinct d) d, sum(distinct f) f from t where a < 10000 group by a
) tmpt;
â¤ count(a)[-5,64,0]  Â¦  sum(d)[3,38,2]  Â¦  sum(f)[8,54,0]  ğ„€
9999  Â¦  45000000.00  Â¦  4.5E7
select 'set max_dop to 1 ... ';
â¤ set max_dop to 1 ... [12,-1,0]  ğ„€
set max_dop to 1 ... 
set @@max_dop = 1;
select 'set agg_spill_mem to 50MB ... ';
â¤ set agg_spill_mem to 50MB ... [12,-1,0]  ğ„€
set agg_spill_mem to 50MB ... 
set @@agg_spill_mem = 60000000;
select count(*) from (select a, b, c from t group by a, b, c) tmptt;
â¤ count(*)[-5,64,0]  ğ„€
1000000
select sum(a), max(c), avg(d), avg(f) from (select a, c, avg(d) as d, avg(f) as f from t group by a, c) tmptt;
â¤ sum(a)[-5,64,0]  Â¦  max(c)[12,-1,0]  Â¦  avg(d)[3,38,12]  Â¦  avg(f)[8,54,0]  ğ„€
500000500000  Â¦  foobar9zoo  Â¦  500000.000000000000  Â¦  500000.0
select count(a), sum(d), sum(f) from (
select count(*), a, sum(d) as d, sum(f) as f from t group by a
) tmptt;
â¤ count(a)[-5,64,0]  Â¦  sum(d)[3,38,2]  Â¦  sum(f)[8,54,0]  ğ„€
1000000  Â¦  900000000000.00  Â¦  9.0E11
select count(a), sum(d), sum(f) from (
select count(*), a, sum(distinct d) d, sum(distinct f) f from t where a < 10000 group by a
) tmptt;
â¤ count(a)[-5,64,0]  Â¦  sum(d)[3,38,2]  Â¦  sum(f)[8,54,0]  ğ„€
9999  Â¦  45000000.00  Â¦  4.5E7
explain analyze select a, b, c from t group by a, b, c;
â¤ ap query plan on one cn(8 core)[12,-1,0]  ğ„€
Project  ğ„€
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1000000 outputRows=1000000 (min=1000000, max=1000000) InputSize=27.66 MiB OutputSize=27.66 MiB ReadSize=0 bytes|0 bytes|0 bytes MemorySize=232.00 KiB (min=232.00 KiB, max=232.00 KiB)  ğ„€
  ->  Aggregate  ğ„€
        Analyze: timeConsumed=2705ms waitTime=0ms inputRows=0 outputRows=1000000 (min=1000000, max=1000000) InputSize=0 bytes OutputSize=27.66 MiB ReadSize=0 bytes|0 bytes|0 bytes MemorySize=78.73 MiB (min=78.73 MiB, max=78.73 MiB) SpillSize=236.18 MiB (min=236.18 MiB, max=236.18 MiB)  ğ„€
        Group Key: t.a, t.b, t.c shuffle: range(t.a)  ğ„€
        ->  Table Scan on qetest.t  ğ„€
              Analyze: timeConsumed=26ms waitTime=0ms inputBlocks=256 inputRows=2000000 outputRows=2000000 (min=2000000, max=2000000) InputSize=55.31 MiB OutputSize=55.31 MiB ReadSize=16.52 MiB|0 bytes|0 bytes MemorySize=464.00 KiB (min=464.00 KiB, max=464.00 KiB)
explain analyze select a, c, avg(d) d, avg(f) f from t group by a, c;
â¤ ap query plan on one cn(8 core)[12,-1,0]  ğ„€
Project  ğ„€
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1000000 outputRows=1000000 (min=1000000, max=1000000) InputSize=49.59 MiB OutputSize=49.59 MiB ReadSize=0 bytes|0 bytes|0 bytes MemorySize=416.00 KiB (min=416.00 KiB, max=416.00 KiB)  ğ„€
  ->  Aggregate  ğ„€
        Analyze: timeConsumed=7203ms waitTime=0ms inputRows=0 outputRows=1000000 (min=1000000, max=1000000) InputSize=0 bytes OutputSize=49.59 MiB ReadSize=0 bytes|0 bytes|0 bytes MemorySize=78.22 MiB (min=78.22 MiB, max=78.22 MiB) SpillSize=234.66 MiB (min=234.66 MiB, max=234.66 MiB)  ğ„€
        Group Key: t.a, t.c shuffle: range(t.a)  ğ„€
        Aggregate Functions: avg(t.d), avg(t.f)  ğ„€
        ->  Table Scan on qetest.t  ğ„€
              Analyze: timeConsumed=152ms waitTime=0ms inputBlocks=256 inputRows=2000000 outputRows=2000000 (min=2000000, max=2000000) InputSize=83.92 MiB OutputSize=83.92 MiB ReadSize=32.19 MiB|0 bytes|0 bytes MemorySize=704.00 KiB (min=704.00 KiB, max=704.00 KiB)
explain analyze select count(*), a, sum(distinct d) d, sum(distinct f) f from t where a < 10000 group by a;
â¤ tp query plan[12,-1,0]  ğ„€
Project  ğ„€
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=9999 outputRows=9999 (min=9999, max=9999) InputSize=351.53 KiB OutputSize=351.53 KiB ReadSize=0 bytes|0 bytes|0 bytes MemorySize=288.00 KiB (min=288.00 KiB, max=288.00 KiB)  ğ„€
  ->  Aggregate  ğ„€
        Analyze: timeConsumed=42ms waitTime=0ms inputRows=19998 outputRows=9999 (min=9999, max=9999) InputSize=390.59 KiB OutputSize=351.53 KiB ReadSize=0 bytes|0 bytes|0 bytes MemorySize=2.69 MiB (min=2.69 MiB, max=2.69 MiB)  ğ„€
        Group Key: t.a  ğ„€
        Aggregate Functions: starcount(1), sum(t.d), sum(t.f)  ğ„€
        ->  Table Scan on qetest.t  ğ„€
              Analyze: timeConsumed=4ms waitTime=0ms inputBlocks=4 inputRows=32768 outputRows=19998 (min=19998, max=19998) InputSize=640.00 KiB OutputSize=390.59 KiB ReadSize=394.71 KiB|0 bytes|0 bytes MemorySize=352.00 KiB (min=160.00 KiB, max=160.00 KiB)  ğ„€
              Filter Cond: (t.a < 10000)  ğ„€
              Block Filter Cond: (t.a < 10000)
drop database qetest;
