drop database if exists test;
create database test;
use test;
create table t1(a int, b int, c int, d int, e int, index(b), index compIdx(c, d), unique index(e));
insert into t1 select *,*,*,*,* from generate_series(1, 100*100*10)g;
delete from t1 where a in (1, 1111, 11111);
select * from t1 where a in (1, 1111, 11111);
a    b    c    d    e
select count(*) from t1;
count(*)
99997
alter table t1 add column f int;
select count(*) from t1;
count(*)
99997
delete from t1 where a in (2, 2222, 22222);
select * from t1 where a in (2, 2222, 22222);
a    b    c    d    e
select a from t1 where b = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
alter table t1 drop column f;
select a from t1 where b = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
alter table t1 modify column a int primary key;
select a from t1 where b = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
alter table t1 drop primary key;
select a from t1 where b = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
alter table t1 add primary key(a);
select a from t1 where b = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
alter table t1 drop primary key;
alter table t1 modify b double;
select a from t1 where b = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
alter table t1 rename column b to b_2;
select a from t1 where b_2 = 9;
a
9
select a from t1 where c = 9000 and d = 9000;
a
9000
select a from t1 where e = 27000;
a
27000
delete from t1 where a mod 19 = 0;
select * from t1 where b_2 in (1, 10, 19, 38, 100);
a    b_2    c    d    e
10    10.0    10    10    10
100    100.0    100    100    100
select * from t1 where c  in (1, 10, 19, 38, 100) and d in (1, 10, 19, 38, 100);
a    b_2    c    d    e
10    10.0    10    10    10
100    100.0    100    100    100
select * from t1 where e in (1, 10, 19, 38, 100);
a    b_2    c    d    e
10    10.0    10    10    10
100    100.0    100    100    100
update t1 set a = a + 1 where c in (8,88,888,8888,88888);
select * from t1 where c in (8,88,888,8888,88888);
a    b_2    c    d    e
9    8.0    8    8    8
89    88.0    88    88    88
889    888.0    888    888    888
8889    8888.0    8888    8888    8888
88889    88888.0    88888    88888    88888
alter table t1 add column f int;
update t1 set a = a + 1 where c in (8,88,888,8888,88888);
select * from t1 where c in (8,88,888,8888,88888);
a    b_2    c    d    e    f
10    8.0    8    8    8    null
90    88.0    88    88    88    null
890    888.0    888    888    888    null
8890    8888.0    8888    8888    8888    null
88890    88888.0    88888    88888    88888    null
set experimental_hnsw_index = 1;
create table t2 (a bigint primary key auto_increment, b vecf32(3), c vecf32(3), d text, index ivfIdx using ivfflat(b) lists=5 op_type "vector_l2_ops", index hnswIdx using hnsw(c) op_type 'vector_l2_ops', fulltext(d));
insert into t2(b,c,d) select CONCAT('[',FLOOR(RAND() * 9),',', FLOOR(RAND() * 9), ',', FLOOR(RAND() * 9),']'), CONCAT('[',FLOOR(RAND() * 9),',', FLOOR(RAND() * 9), ',', FLOOR(RAND() * 9),']'), * from generate_series(1, 1000)g;
insert into t2(b,c,d) values("[1,1,1]","[1,1,1]","111"),("[9,9,9]","[9,9,9]","999");
alter table t2 add column f int;
select floor(max(l2_distance(b, "[1,1,1]"))) from t2;
floor(max(l2_distance(b, [1,1,1])))
13.0
select floor(max(l2_distance(c, "[1,1,1]"))) from t2;
floor(max(l2_distance(c, [1,1,1])))
13.0
select a,d from t2 where match(d) against('234' in boolean mode);
a    d
234    234
set experimental_hnsw_index = 0;
drop database test;
