drop database if exists test;
create database test;
use test;
create table t1(a int, b int, primary key(a));
insert into t1 select *,* from generate_series(1, 8192)g;
delete from t1 where a in (9, 99, 999);
create table t2(a int, b int, primary key(a));
insert into t2 select *,* from generate_series(1, 8192)g;
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t2    INSERT    9    9
t2    INSERT    99    99
t2    INSERT    999    999
delete from t2 where a in (9, 99, 999);
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
drop table t1;
drop table t2;
create table t1(a int, b int, primary key(a));
insert into t1 select *,* from generate_series(1, 8192)g;
update t1 set b = b+1 where a in (9, 99, 999);
create table t2(a int, b int, primary key(a));
insert into t2 select *,* from generate_series(1, 8192)g;
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t1    INSERT    9    10
t2    INSERT    9    9
t1    INSERT    99    100
t2    INSERT    99    99
t1    INSERT    999    1000
t2    INSERT    999    999
update t2 set b = b+1 where a in (9, 99, 999);
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
drop table t1;
drop table t2;
create table t0(a int, b int, primary key(a));
insert into t0 values(1,1),(2,2),(3,3);
data branch create table t1 from t0;
insert into t1 values(4,4);
delete from t1 where a = 3;
data branch create table t2 from t0;
insert into t2 values(5, 5);
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t2    INSERT    5    5
t1    DELETE    3    3
t1    INSERT    4    4
delete from t2 where a = 3;
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t2    INSERT    5    5
t1    INSERT    4    4
drop table t0;
drop table t1;
drop table t2;
create table t0(a int, b int, primary key(a));
insert into t0 values(1,1),(2,2),(3,3);
data branch create table t1 from t0;
insert into t1 values(4,4);
update t1 set b = b + 1 where a = 3;
data branch create table t2 from t0;
insert into t2 values(5,5);
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t2    INSERT    5    5
t1    UPDATE    3    4
t1    INSERT    4    4
update t2 set b = b + 1 where a = 3;
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t2    INSERT    5    5
t1    INSERT    4    4
drop table t0;
drop table t1;
drop table t2;
create table t1(a int, b int, primary key(a));
insert into t1 select *,* from generate_series(1,100)g;
data branch create table t2 from t1;
insert into t2 select *,* from generate_series(101,200)g;
delete from t2 where a >= 100;
data branch diff t2 against t1;
diff t2 against t1    flag    a    b
t2    DELETE    100    100
drop table t1;
drop table t2;
create table t0(a int, b int, c int, primary key(a, b));
insert into t0 select *,*,* from generate_series(1, 8192)g;
data branch create table t1 from t0;
update t1 set c = c + 1 where a in (1, 100, 1000);
insert into t1 values(9000, 9000, 9000);
data branch create table t2 from t0;
update t2 set c = c + 1 where a in (2, 200, 1000);
insert into t2 values(9001, 9001, 9001);
data branch diff t2 against t1;
diff t2 against t1    flag    a    b    c
t2    UPDATE    2    2    3
t1    UPDATE    1    1    2
t2    UPDATE    200    200    201
t1    UPDATE    100    100    101
t2    INSERT    9001    9001    9001
t1    INSERT    9000    9000    9000
drop database test;
