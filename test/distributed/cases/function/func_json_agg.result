CREATE TABLE t3(o_id INT, attribute VARCHAR(20), value VARCHAR(20));
INSERT INTO t3 VALUES
(2,'color','red'),
(2,'fabric','silk'),
(3,'color','green'),
(3,'shape','square');
SELECT o_id, JSON_ARRAYAGG(attribute) AS attributes FROM t3 GROUP BY o_id ORDER BY o_id;
o_id    attributes
2    ["color", "fabric"]
3    ["color", "shape"]
SELECT o_id, JSON_OBJECTAGG(attribute, value) AS details FROM t3 GROUP BY o_id ORDER BY o_id;
o_id    details
2    {"color": "red", "fabric": "silk"}
3    {"color": "green", "shape": "square"}
CREATE TABLE t_dup(c VARCHAR(10), i INT);
INSERT INTO t_dup VALUES ('key',3),('key',4),('key',5);
SELECT JSON_OBJECTAGG(c,i) AS obj1 FROM t_dup;
obj1
{"key": 5}
DELETE FROM t_dup;
INSERT INTO t_dup VALUES ('key',3),('key',5),('key',4);
SELECT JSON_OBJECTAGG(c,i) AS obj2 FROM t_dup;
obj2
{"key": 4}
DROP TABLE t_dup;
DROP TABLE t3;
CREATE TABLE t_arr_ext(g INT, pos INT, v INT);
INSERT INTO t_arr_ext VALUES
(1,1,5),
(1,2,1),
(1,3,5),
(1,4,3),
(1,5,1),
(1,6,2),
(2,1,7),
(2,2,7),
(2,3,8),
(2,4,9),
(2,5,8);
SELECT g, JSON_ARRAYAGG(v) AS ordered_array FROM (SELECT g, pos, v FROM t_arr_ext ORDER BY g, pos) AS s GROUP BY g ORDER BY g;
g    ordered_array
1    [5, 1, 5, 3, 1, 2]
2    [7, 7, 8, 9, 8]
SELECT g, JSON_ARRAYAGG(v) AS distinct_array FROM (SELECT DISTINCT g, v FROM t_arr_ext ORDER BY g, v) AS s GROUP BY g ORDER BY g;
g    distinct_array
1    [1, 2, 3, 5]
2    [7, 8, 9]
DROP TABLE t_arr_ext;
CREATE TABLE t_obj_ext(g INT, pos INT, k VARCHAR(20), v INT);
INSERT INTO t_obj_ext VALUES
(1,1,'alpha',10),
(1,2,'beta',20),
(1,3,'alpha',30),
(1,4,'gamma',40),
(2,1,'north',100),
(2,2,'south',200),
(2,3,'north',300),
(2,4,'east',400),
(2,5,'west',500);
SELECT g, JSON_OBJECTAGG(k,v) AS obj_map FROM (SELECT g, pos, k, v FROM t_obj_ext ORDER BY g, pos) AS s GROUP BY g ORDER BY g;
g    obj_map
1    {"alpha": 30, "beta": 20, "gamma": 40}
2    {"east": 400, "north": 300, "south": 200, "west": 500}
DROP TABLE t_obj_ext;
