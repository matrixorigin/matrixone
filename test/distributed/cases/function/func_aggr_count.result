SELECT COUNT(NULL);
➤ COUNT(null)[-5,64,0]  𝄀
0
create table t1(a tinyint, b SMALLINT, c bigint, d INT, e BIGINT, f FLOAT, g DOUBLE, h decimal(38,19), i DATE, k datetime, l TIMESTAMP, m char(255), n varchar(255));
insert into t1 values(1, 1, 2, 4, 5, 5.5, 31.13, 14.314, "2012-03-12", "2012-03-12 10:03:12", "2012-03-12 13:03:12", "abc", "dcf");
insert into t1 values(1, 1, 2, 4, 5, 5.5, 31.13, 14.314, "2012-03-12", "2012-03-12 10:03:12", "2012-03-12 13:03:12", "abc", "dcf");
insert into t1 values(1, 1, 2, 4, 5, 5.5, 31.13, 14.314, "2012-03-12", "2012-03-12 10:03:12", "2012-03-12 13:03:12", "abc", "dcf");
insert into t1 values(1, 1, 2, 4, 5, 5.5, 31.13, 14.314, "2012-03-12", "2012-03-12 10:03:12", "2012-03-12 13:03:12", "abc", "dcf");
select count(a) from t1;
➤ count(a)[-5,64,0]  𝄀
4
select count(b) from t1;
➤ count(b)[-5,64,0]  𝄀
4
select count(c) from t1;
➤ count(c)[-5,64,0]  𝄀
4
select count(d) from t1;
➤ count(d)[-5,64,0]  𝄀
4
select count(e) from t1;
➤ count(e)[-5,64,0]  𝄀
4
select count(f) from t1;
➤ count(f)[-5,64,0]  𝄀
4
select count(g) from t1;
➤ count(g)[-5,64,0]  𝄀
4
select count(h) from t1;
➤ count(h)[-5,64,0]  𝄀
4
select count(i) from t1;
➤ count(i)[-5,64,0]  𝄀
4
select count(k) from t1;
➤ count(k)[-5,64,0]  𝄀
4
select count(l) from t1;
➤ count(l)[-5,64,0]  𝄀
4
select count(m) from t1;
➤ count(m)[-5,64,0]  𝄀
4
select count(n) from t1;
➤ count(n)[-5,64,0]  𝄀
4
drop table t1;
create table t1(a int);
select count(*) from t1;
➤ count(*)[-5,64,0]  𝄀
0
explain analyze select count(*) from t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: starcount\(1\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=0 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: starcount(1)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=0 inputRows=0 outputRows=0 (min=0, max=0) InputSize=0 bytes OutputSize=0 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
              Aggregate Functions: starcount(1)
insert into t1 values(null),(null),(null),(null);
select count(*) from t1;
➤ count(*)[-5,64,0]  𝄀
4
select count(a) from t1;
➤ count(a)[-5,64,0]  𝄀
0
drop table t1;
CREATE TABLE t1 (
bug_id bigint(9) NOT NULL,
groupset bigint(20) DEFAULT 0 NOT NULL,
assigned_to bigint(9) DEFAULT 0 NOT NULL,
bug_file_loc varchar(255)
);
CREATE TABLE t2 (
value varchar(255),
program varchar(64),
initialowner varchar(255) NOT NULL,
initialqacontact varchar(255) NOT NULL,
description varchar(255) NOT NULL
);
INSERT INTO t1 VALUES (1,0,0,'TestComponent');
INSERT INTO t1 VALUES (2,0,0,'BBBBBBBBBBBBB');
INSERT INTO t1 VALUES (3,0,0,'TestComponent2');
INSERT INTO t1 VALUES (4,0,0,'TestComponent2');
INSERT INTO t2 VALUES ('TestComponent','TestProduct','id0001','','');
INSERT INTO t2 VALUES ('BBBBBBBBBBBBB - conversion','AAAAA','id0001','','');
INSERT INTO t2 VALUES ('BBBBBBBBBBBBB - generic','AAAAA','id0001','','');
INSERT INTO t2 VALUES ('TestComponent2','TestProduct','id0001','','');
select any_value(value),any_value(description),COUNT(bug_id) from t2 left join t1 on t2.value=t1.bug_file_loc group by value having COUNT(bug_id) IN (0,2);
➤ any_value(value)[12,-1,0]  ¦  any_value(description)[12,-1,0]  ¦  COUNT(bug_id)[-5,64,0]  𝄀
BBBBBBBBBBBBB - conversion  ¦    ¦  0  𝄀
BBBBBBBBBBBBB - generic  ¦    ¦  0  𝄀
TestComponent2  ¦    ¦  2
SELECT COUNT(t1.bug_id) >= COUNT(t2.value) from t1 join t2 on t1.bug_file_loc = t2.value;
➤ COUNT(t1.bug_id) >= COUNT(t2.value)[-7,1,0]  𝄀
1
drop table t1;
drop table t2;
create table t1 (grp int, a bigint unsigned, c char(10) not null);
insert into t1 values (1,1,"a");
insert into t1 values (2,2,"b");
insert into t1 values (2,3,"c");
insert into t1 values (3,4,"E");
insert into t1 values (3,5,"C");
insert into t1 values (3,6,"D");
select sum(a) from t1 where a > 10;
➤ sum(a)[-5,64,0]  𝄀
null
select count(distinct a),count(distinct grp) from t1;
➤ count(distinct a)[-5,64,0]  ¦  count(distinct grp)[-5,64,0]  𝄀
6  ¦  3
insert into t1 values (null,null,'');
select count(distinct a),count(distinct grp) from t1;
➤ count(distinct a)[-5,64,0]  ¦  count(distinct grp)[-5,64,0]  𝄀
6  ¦  3
create table t2 (grp int, a bigint unsigned, c char(10));
insert into t2 select grp,max(a)+max(grp),max(c) from t1 group by grp;
drop table t1;
drop table t2;
create table t1 (a smallint(6) primary key, c char(10), b varchar(255));
INSERT INTO t1 VALUES (1,'1','1');
INSERT INTO t1 VALUES (2,'2','2');
INSERT INTO t1 VALUES (4,'4','4');
select count(*) from t1;
➤ count(*)[-5,64,0]  𝄀
3
select count(*) from t1 where a = 1;
➤ count(*)[-5,64,0]  𝄀
1
select count(*) from t1 where a = 100;
➤ count(*)[-5,64,0]  𝄀
0
select count(*) from t1 where a >= 10;
➤ count(*)[-5,64,0]  𝄀
0
select count(a) from t1 where a = 1;
➤ count(a)[-5,64,0]  𝄀
1
select count(a) from t1 where a = 100;
➤ count(a)[-5,64,0]  𝄀
0
select count(a) from t1 where a >= 10;
➤ count(a)[-5,64,0]  𝄀
0
explain analyze select count(*) from t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: starcount\(1\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=0 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: starcount(1)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=0 inputRows=0 outputRows=0 (min=0, max=0) InputSize=0 bytes OutputSize=0 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
              Aggregate Functions: starcount(1)
explain analyze select count(a) from t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: starcount\(t1\.a\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=0 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: count(t1.a)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=0 inputRows=0 outputRows=0 (min=0, max=0) InputSize=0 bytes OutputSize=0 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
              Aggregate Functions: starcount(t1.a)
explain analyze select count(a) from t1 where a = 1;
-- @regex("(?s)Table Scan.*Filter Cond", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=2 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: count(t1.a)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=1 inputRows=1 outputRows=1 (min=1, max=1) InputSize=2 bytes OutputSize=2 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=5 bytes (min=2 bytes, max=2 bytes)  𝄀
              Filter Cond: (t1.a = 1)
select count(b) from t1 where b >= 2;
➤ count(b)[-5,64,0]  𝄀
2
select count(b) from t1 where b >= 10;
➤ count(b)[-5,64,0]  𝄀
0
select count(c) from t1 where c = 10;
➤ count(c)[-5,64,0]  𝄀
0
drop table t1;
CREATE TABLE t1 (d DATETIME, i INT);
INSERT INTO t1 SELECT "2021-10-23 10:01:01", 1;
SELECT COUNT(i), i, COUNT(i)*i FROM t1 GROUP BY i;
➤ COUNT(i)[-5,64,0]  ¦  i[4,32,0]  ¦  COUNT(i) * i[-5,64,0]  𝄀
1  ¦  1  ¦  1
SELECT COUNT(i), (i+0), COUNT(i)*(i+0) FROM t1 GROUP BY i;
➤ COUNT(i)[-5,64,0]  ¦  i + 0[-5,64,0]  ¦  COUNT(i) * (i + 0)[-5,64,0]  𝄀
1  ¦  1  ¦  1
DROP TABLE t1;
CREATE TABLE t1 (a int, b int);
select count(b), sum(b), avg(b), std(b), min(b), max(b), bit_and(b), bit_or(b) from t1;
➤ count(b)[-5,64,0]  ¦  sum(b)[-5,64,0]  ¦  avg(b)[8,54,0]  ¦  std(b)[8,54,0]  ¦  min(b)[4,32,0]  ¦  max(b)[4,32,0]  ¦  bit_and(b)[-5,64,0]  ¦  bit_or(b)[-5,64,0]  𝄀
0  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null
select a,count(b), sum(b), avg(b), std(b), min(b), max(b), bit_and(b), bit_or(b) from t1 group by a;
➤ a[4,32,0]  ¦  count(b)[-5,64,0]  ¦  sum(b)[-5,64,0]  ¦  avg(b)[8,54,0]  ¦  std(b)[8,54,0]  ¦  min(b)[4,32,0]  ¦  max(b)[4,32,0]  ¦  bit_and(b)[-5,64,0]  ¦  bit_or(b)[-5,64,0]
insert into t1 values (1,null);
select a,count(b), sum(b), avg(b), std(b), min(b), max(b), bit_and(b), bit_or(b) from t1 group by a;
➤ a[4,32,0]  ¦  count(b)[-5,64,0]  ¦  sum(b)[-5,64,0]  ¦  avg(b)[8,54,0]  ¦  std(b)[8,54,0]  ¦  min(b)[4,32,0]  ¦  max(b)[4,32,0]  ¦  bit_and(b)[-5,64,0]  ¦  bit_or(b)[-5,64,0]  𝄀
1  ¦  0  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null
insert into t1 values (1,null);
insert into t1 values (2,null);
select a,count(b), sum(b), avg(b), std(b), min(b), max(b), bit_and(b), bit_or(b) from t1 group by a;
➤ a[4,32,0]  ¦  count(b)[-5,64,0]  ¦  sum(b)[-5,64,0]  ¦  avg(b)[8,54,0]  ¦  std(b)[8,54,0]  ¦  min(b)[4,32,0]  ¦  max(b)[4,32,0]  ¦  bit_and(b)[-5,64,0]  ¦  bit_or(b)[-5,64,0]  𝄀
1  ¦  0  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  𝄀
2  ¦  0  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null
insert into t1 values (2,1);
select a,count(b), sum(b), avg(b), std(b), min(b), max(b), bit_and(b), bit_or(b) from t1 group by a;
➤ a[4,32,0]  ¦  count(b)[-5,64,0]  ¦  sum(b)[-5,64,0]  ¦  avg(b)[8,54,0]  ¦  std(b)[8,54,0]  ¦  min(b)[4,32,0]  ¦  max(b)[4,32,0]  ¦  bit_and(b)[-5,64,0]  ¦  bit_or(b)[-5,64,0]  𝄀
1  ¦  0  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  𝄀
2  ¦  1  ¦  1  ¦  1.0  ¦  0.0  ¦  1  ¦  1  ¦  1  ¦  1
insert into t1 values (3,1);
select a,count(b), sum(b), avg(b), std(b), min(b), max(b), bit_and(b), bit_or(b) from t1 group by a;
➤ a[4,32,0]  ¦  count(b)[-5,64,0]  ¦  sum(b)[-5,64,0]  ¦  avg(b)[8,54,0]  ¦  std(b)[8,54,0]  ¦  min(b)[4,32,0]  ¦  max(b)[4,32,0]  ¦  bit_and(b)[-5,64,0]  ¦  bit_or(b)[-5,64,0]  𝄀
1  ¦  0  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  ¦  null  𝄀
2  ¦  1  ¦  1  ¦  1.0  ¦  0.0  ¦  1  ¦  1  ¦  1  ¦  1  𝄀
3  ¦  1  ¦  1  ¦  1.0  ¦  0.0  ¦  1  ¦  1  ¦  1  ¦  1
explain analyze select count(b) from t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: count\(t1\.b\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=6 outputRows=1 (min=1, max=1) InputSize=20 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: count(t1.b)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=1 inputRows=5 outputRows=5 (min=5, max=5) InputSize=20 bytes OutputSize=20 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=40 bytes (min=40 bytes, max=40 bytes)  𝄀
              Aggregate Functions: count(t1.b)
explain analyze select count(*) from t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: starcount\(1\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=0 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: starcount(1)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=0 inputRows=0 outputRows=0 (min=0, max=0) InputSize=0 bytes OutputSize=0 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
              Aggregate Functions: starcount(1)
drop table t1;
CREATE TABLE t1 (a INT, b INT);
INSERT INTO t1 VALUES (1,1),(1,2),(2,3);
SELECT (SELECT COUNT(DISTINCT t1.b)) FROM t1 GROUP BY t1.a;
correlated columns in aggregate function is not yet implemented
SELECT (SELECT COUNT(DISTINCT 12)) FROM t1 GROUP BY t1.a;
➤ (select COUNT(distinct 12))[-5,64,0]  𝄀
1  𝄀
1
SELECT AVG(2), BIT_AND(2), BIT_OR(2), BIT_XOR(2), COUNT(*), COUNT(12),COUNT(DISTINCT 12), MIN(2),MAX(2),STD(2), VARIANCE(2),SUM(2);
➤ AVG(2)[8,54,0]  ¦  BIT_AND(2)[-5,64,0]  ¦  BIT_OR(2)[-5,64,0]  ¦  BIT_XOR(2)[-5,64,0]  ¦  COUNT(*)[-5,64,0]  ¦  COUNT(12)[-5,64,0]  ¦  COUNT(distinct 12)[-5,64,0]  ¦  MIN(2)[-5,64,0]  ¦  MAX(2)[-5,64,0]  ¦  STD(2)[8,54,0]  ¦  VARIANCE(2)[8,54,0]  ¦  SUM(2)[-5,64,0]  𝄀
2.0  ¦  2  ¦  2  ¦  2  ¦  1  ¦  1  ¦  1  ¦  2  ¦  2  ¦  0.0  ¦  0.0  ¦  2
DROP TABLE t1;
CREATE TABLE t1 (col1 decimal(16,12));
INSERT INTO t1 VALUES (-5.00000000001),(-5.00000000002),(-5.00000000003),(-5.00000000000),(-5.00000000001),(-5.00000000002);
insert into t1 select * from t1;
select col1,count(col1),sum(col1),avg(col1) from t1 group by col1;
➤ col1[3,16,12]  ¦  count(col1)[-5,64,0]  ¦  sum(col1)[3,38,12]  ¦  avg(col1)[3,38,12]  𝄀
-5.000000000010  ¦  4  ¦  -20.000000000040  ¦  -5.000000000010  𝄀
-5.000000000020  ¦  4  ¦  -20.000000000080  ¦  -5.000000000020  𝄀
-5.000000000030  ¦  2  ¦  -10.000000000060  ¦  -5.000000000030  𝄀
-5.000000000000  ¦  2  ¦  -10.000000000000  ¦  -5.000000000000
DROP TABLE t1;
CREATE TABLE t1 (a VARCHAR(400));
INSERT INTO t1 (a) VALUES ("A"), ("a"), ("a "), ("a   "),("B"), ("b"), ("b "), ("b   ");
SELECT COUNT(DISTINCT a) FROM t1;
➤ COUNT(distinct a)[-5,64,0]  𝄀
8
DROP TABLE t1;
create table bug22555 (i smallint, s1 smallint, s2 smallint, o1 double, o2 double, e1 decimal, e2 decimal);
insert into bug22555 values (1,53,78,53,78,53,78),(2,17,78,17,78,17,78),(3,18,76,18,76,18,76);
select i, count(*) from bug22555 group by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  𝄀
1  ¦  1  𝄀
2  ¦  1  𝄀
3  ¦  1
select std(s1/s2) from bug22555 where i=1;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0
select std(s1/s2) from bug22555 where i=2;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0
select std(s1/s2) from bug22555 where i=3;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0
select std(s1/s2) from bug22555 where i=1 group by i;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0
select std(s1/s2) from bug22555 where i=2 group by i;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0
select std(s1/s2) from bug22555 where i=3 group by i;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0
select std(s1/s2) from bug22555 group by i order by i;
➤ std(s1 / s2)[8,54,0]  𝄀
0.0  𝄀
0.0  𝄀
0.0
select i, count(*), std(o1/o2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(o1 / o2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), std(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(e1 / e2)[3,38,12]  𝄀
1  ¦  1  ¦  0E-12  𝄀
2  ¦  1  ¦  0E-12  𝄀
3  ¦  1  ¦  0E-12
select i, count(*), variance(s1/s2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  variance(s1 / s2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), variance(o1/o2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  variance(o1 / o2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), variance(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  variance(e1 / e2)[3,38,12]  𝄀
1  ¦  1  ¦  0E-12  𝄀
2  ¦  1  ¦  0E-12  𝄀
3  ¦  1  ¦  0E-12
select i, count(*), std(s1/s2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(s1 / s2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), std(o1/o2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(o1 / o2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), std(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(e1 / e2)[3,38,12]  𝄀
1  ¦  1  ¦  0E-12  𝄀
2  ¦  1  ¦  0E-12  𝄀
3  ¦  1  ¦  0E-12
select i, count(*), variance(s1/s2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  variance(s1 / s2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), variance(o1/o2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  variance(o1 / o2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), variance(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  variance(e1 / e2)[3,38,12]  𝄀
1  ¦  1  ¦  0E-12  𝄀
2  ¦  1  ¦  0E-12  𝄀
3  ¦  1  ¦  0E-12
select i, count(*), std(s1/s2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(s1 / s2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), std(o1/o2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(o1 / o2)[8,54,0]  𝄀
1  ¦  1  ¦  0.0  𝄀
2  ¦  1  ¦  0.0  𝄀
3  ¦  1  ¦  0.0
select i, count(*), std(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(e1 / e2)[3,38,12]  𝄀
1  ¦  1  ¦  0E-12  𝄀
2  ¦  1  ¦  0E-12  𝄀
3  ¦  1  ¦  0E-12
insert into bug22555 values (1,53,78,53,78,53,78),(2,17,78,17,78,17,78),(3,18,76,18,76,18,76);
insert into bug22555 values (1,53,78,53,78,53,78),(2,17,78,17,78,17,78),(3,18,76,18,76,18,76);
insert into bug22555 values (1,53,78,53,78,53,78),(2,17,78,17,78,17,78),(3,18,76,18,76,18,76);
select i, count(*), std(s1/s2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(s1 / s2)[8,54,0]  𝄀
1  ¦  4  ¦  0.0  𝄀
2  ¦  4  ¦  0.0  𝄀
3  ¦  4  ¦  0.0
select i, count(*), round(std(o1/o2), 16) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  round(std(o1 / o2), 16)[8,54,0]  𝄀
1  ¦  4  ¦  0.0  𝄀
2  ¦  4  ¦  0.0  𝄀
3  ¦  4  ¦  0.0
select i, count(*), std(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(e1 / e2)[3,38,12]  𝄀
1  ¦  4  ¦  0E-12  𝄀
2  ¦  4  ¦  0E-12  𝄀
3  ¦  4  ¦  0E-12
select std(s1/s2) from bug22555;
➤ std(s1 / s2)[8,54,0]  𝄀
0.2132576358664934
select std(o1/o2) from bug22555;
➤ std(o1 / o2)[8,54,0]  𝄀
0.2132576358664934
select std(e1/e2) from bug22555;
➤ std(e1 / e2)[3,38,12]  𝄀
0.213257503950
select i, count(*), std(s1/s2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(s1 / s2)[8,54,0]  𝄀
1  ¦  4  ¦  0.0  𝄀
2  ¦  4  ¦  0.0  𝄀
3  ¦  4  ¦  0.0
select i, count(*), round(std(o1/o2), 16) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  round(std(o1 / o2), 16)[8,54,0]  𝄀
1  ¦  4  ¦  0.0  𝄀
2  ¦  4  ¦  0.0  𝄀
3  ¦  4  ¦  0.0
select i, count(*), std(e1/e2) from bug22555 group by i order by i;
➤ i[5,16,0]  ¦  count(*)[-5,64,0]  ¦  std(e1 / e2)[3,38,12]  𝄀
1  ¦  4  ¦  0E-12  𝄀
2  ¦  4  ¦  0E-12  𝄀
3  ¦  4  ¦  0E-12
select round(std(s1/s2), 17) from bug22555;
➤ round(std(s1 / s2), 17)[8,54,0]  𝄀
0.2132576358664934
select std(o1/o2) from bug22555;
➤ std(o1 / o2)[8,54,0]  𝄀
0.2132576358664934
select round(std(e1/e2), 17) from bug22555;
➤ round(std(e1 / e2), 17)[3,38,12]  𝄀
0.213257503950
drop table bug22555;
create table t1 (a decimal(20));
insert into t1 values (12345678901234567890);
select count(a) from t1;
➤ count(a)[-5,64,0]  𝄀
1
select count(distinct a) from t1;
➤ count(distinct a)[-5,64,0]  𝄀
1
drop table t1;
CREATE TABLE t1 (a INT, b INT);
INSERT INTO t1 VALUES (1,1),(1,2),(1,3),(1,4),(1,5),(1,6),(1,7),(1,8);
INSERT INTO t1 SELECT a, b+8       FROM t1;
INSERT INTO t1 SELECT a, b+16      FROM t1;
INSERT INTO t1 SELECT a, b+32      FROM t1;
INSERT INTO t1 SELECT a, b+64      FROM t1;
INSERT INTO t1 SELECT a, b+128     FROM t1;
INSERT INTO t1 SELECT a, b+256     FROM t1;
INSERT INTO t1 SELECT a, b+512     FROM t1;
INSERT INTO t1 SELECT a, b+1024    FROM t1;
INSERT INTO t1 SELECT a, b+2048    FROM t1;
INSERT INTO t1 SELECT a, b+4096    FROM t1;
INSERT INTO t1 SELECT a, b+8192    FROM t1;
INSERT INTO t1 SELECT a, b+16384   FROM t1;
INSERT INTO t1 SELECT a, b+32768   FROM t1;
SELECT a,COUNT(DISTINCT b) AS cnt FROM t1 GROUP BY a HAVING cnt > 50;
➤ a[4,32,0]  ¦  cnt[-5,64,0]  𝄀
1  ¦  65536
SELECT a, SUM( b) AS sumation FROM t1 GROUP BY a HAVING sumation > 50;
➤ a[4,32,0]  ¦  sumation[-5,64,0]  𝄀
1  ¦  2147516416
SELECT a, AVG( b) AS average FROM t1 GROUP BY a HAVING average > 50;
➤ a[4,32,0]  ¦  average[8,54,0]  𝄀
1  ¦  32768.5
SELECT a,COUNT(DISTINCT b) FROM t1 GROUP BY a HAVING COUNT(DISTINCT b) > 50;
➤ a[4,32,0]  ¦  COUNT(distinct b)[-5,64,0]  𝄀
1  ¦  65536
SELECT DISTINCT a, SUM( b) FROM t1 GROUP BY a HAVING SUM( b) > 50;
➤ a[4,32,0]  ¦  SUM(b)[-5,64,0]  𝄀
1  ¦  2147516416
SELECT DISTINCT a, AVG( b) FROM t1 GROUP BY a HAVING AVG( b) > 50;
➤ a[4,32,0]  ¦  AVG(b)[8,54,0]  𝄀
1  ¦  32768.5
select count(distinct(a, b)) from t1;
internal error: tuple is not supported as group by column
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 SELECT result FROM generate_series(1,100000) g;
SELECT COUNT(*) FROM t1;
➤ COUNT(*)[-5,64,0]  𝄀
100000
explain analyze SELECT COUNT(*) FROM t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: starcount\(1\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=0 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: starcount(1)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=0 inputRows=0 outputRows=0 (min=0, max=0) InputSize=0 bytes OutputSize=0 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
              Aggregate Functions: starcount(1)
explain analyze SELECT COUNT(a) FROM t1;
-- @regex("(?s)Table Scan.*Aggregate Functions: count\(t1\.a\)", true)
➤ tp query plan[12,-1,0]  𝄀
Project  𝄀
  Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=8 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=8 bytes (min=8 bytes, max=8 bytes)  𝄀
  ->  Aggregate  𝄀
        Analyze: timeConsumed=0ms waitTime=0ms inputRows=1 outputRows=1 (min=1, max=1) InputSize=0 bytes OutputSize=8 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
        Aggregate Functions: count(t1.a)  𝄀
        ->  Table Scan on func_aggr_count.t1  𝄀
              Analyze: timeConsumed=0ms waitTime=0ms inputBlocks=0 inputRows=0 outputRows=0 (min=0, max=0) InputSize=0 bytes OutputSize=0 bytes ReadSize=0 bytes|0 bytes|0 bytes MemorySize=0 bytes (min=0 bytes, max=0 bytes)  𝄀
              Aggregate Functions: count(t1.a)
DELETE FROM t1 WHERE a>50000;
SELECT COUNT(*) FROM t1;
➤ COUNT(*)[-5,64,0]  𝄀
50000
SELECT COUNT(a) FROM t1;
➤ COUNT(a)[-5,64,0]  𝄀
50000
DELETE FROM t1 WHERE a%2=1;
SELECT COUNT(*) FROM t1;
➤ COUNT(*)[-5,64,0]  𝄀
25000
DROP TABLE t1;
