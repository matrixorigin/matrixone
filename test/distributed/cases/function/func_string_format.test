-- @suit
-- @case
-- @test function format()
-- @label:bvt

-- constant test
SELECT FORMAT(12332.123456, 4);
SELECT FORMAT(12332.1,4);
SELECT FORMAT(12332.2,0);
SELECT FORMAT(19999999.999999999,4);


SELECT FORMAT("-.12334.2",2);
SELECT FORMAT("12332.123456", 4);
SELECT FORMAT("12332.1",4);
SELECT FORMAT("12332.2",0);
SELECT FORMAT("19999999.999999999",4);
SELECT FORMAT(12332.123456, "4");
SELECT FORMAT(12332.1,"4");
SELECT FORMAT(12332.2,"0");
SELECT FORMAT(19999999.999999999,"4");
SELECT FORMAT("-.12334.2","2");
SELECT FORMAT("12332.123456", "4");
SELECT FORMAT("12332.1","4");
SELECT FORMAT("12332.2","0");
SELECT FORMAT("19999999.999999999","4");

SELECT FORMAT("-.12334.2","2", "en_US");
SELECT FORMAT("12332.123456", "4", "en_US");
SELECT FORMAT("12332.1","4",  "en_US");
SELECT FORMAT("12332.2","0",  "en_US");
SELECT FORMAT("19999999.999999999","4", "en_US");

SELECT FORMAT("-.12334.2","2", "ar_SA");
SELECT FORMAT("12332.123456", "4",  "ar_SA");
SELECT FORMAT("12332.1","4",  "ar_SA");
SELECT FORMAT("12332.2","0",  "ar_SA");
SELECT FORMAT("19999999.999999999","4",  "ar_SA");

SELECT FORMAT("-.12334.2","2", "be_BY");
SELECT FORMAT("12332.123456", "4",  "be_BY");
SELECT FORMAT("12332.1","4",  "be_BY");
SELECT FORMAT("12332.2","0",  "be_BY");
SELECT FORMAT("19999999.999999999","4",  "be_BY");

SELECT FORMAT("-.12334.2","2", "bg_BG");
SELECT FORMAT("12332.123456", "4",  "bg_BG");
SELECT FORMAT("12332.1","4",  "bg_BG");
SELECT FORMAT("12332.2","0",  "bg_BG");
SELECT FORMAT("19999999.999999999","4",  "bg_BG");

SELECT FORMAT("-.12334.2","2", "de_CH");
SELECT FORMAT("12332.123456", "4",  "de_CH");
SELECT FORMAT("12332.1","4",  "de_CH");
SELECT FORMAT("12332.2","0",  "de_CH");
SELECT FORMAT("19999999.999999999","4",  "de_CH");


create table test(a varchar(100), b varchar(100));
insert into test values("-.12334.2","2");
insert into test values("12332.123456", "4");
insert into test values("12332.1","4");
insert into test values("12332.2","0");
insert into test values("19999999.999999999");
SELECT FORMAT(a, b) from test;
SELECT FORMAT(a, b, null) from test;
SELECT FORMAT(a, b, "en_US") from test;
SELECT FORMAT(a, b, "ar_SA") from test;
SELECT FORMAT(a, b, "be_BY") from test;
SELECT FORMAT(a, b, "bg_BG") from test;
SELECT FORMAT(a, b, "de_CH") from test;
drop table test;

create table test(a varchar(100), b varchar(100), c varchar(20));
insert into test values("-.12334.2","2", "en_US");
insert into test values("12332.123456", "4", "en_US");
insert into test values("12332.1","4", "en_US");
insert into test values("12332.2","0", "en_US");
insert into test values("19999999.999999999","en_US");
create table test(a varchar(100), b varchar(100), c varchar(20));
insert into test values("-.12334.2","2", "de_CH");
insert into test values("12332.123456", "4", "de_CH");
insert into test values("12332.1","4", "de_CH");
insert into test values("12332.2","0", "de_CH");
insert into test values("19999999.999999999","de_CH");
drop table test;

create table t(id int, d1 float, d2 double not null);
insert into t values(4, 0, -38902093.4324);
insert into t values(5, 323, 37827329.43432);
insert into t values(8, 7382,3923404.2132421);
insert into t values(5, 2, 10000000);
select format(d2, id) from t;
drop table t;

-- @suite
-- @setup
DROP TABLE IF EXISTS format_01;
CREATE TABLE format_01(id INT, d1 tinyint, d2 smallint unsigned, d3 int, d4 bigint unsigned, PRIMARY KEY (id));
-- tinyint:Support positive and negative
INSERT INTO format_01 VALUES(1, -3, 46382, 46787698, 454987456415);
-- Support null value insertion
INSERT INTO format_01 VALUES(2, 126, NULL, 743482 , 938256415);
INSERT INTO format_01 VALUES(3, 21, 37821, 3782, 0);
INSERT INTO format_01 VALUES(4, 0, 0, 0, 0);


-- Abnormal insertion
INSERT INTO format_01 VALUES(5, 127, 3892, 743482 , 938256415);
INSERT INTO format_01 VALUES(6, 22, 3, 4, 184467440737095516152);


-- @case
-- @ integer test
SELECT format(d1, id) from format_01;
SELECT format(d1, id, NULL) from format_01;
SELECT format(d1, id, "en_US") from format_01;
SELECT format(d1, id, "ar_SA") from format_01;
SELECT format(d1, id, "be_BY") from format_01;
SELECT format(d1, id, "bg_BG") from format_01;


-- Filtering, nesting, mathematical operation
SELECT * FROM format_01 WHERE format(d1,0) = 126;
SELECT id FROM (SELECT * FROM format_01 WHERE format(d1,0) = 126) as a;
SELECT format(d1, id) FROM format_01 WHERE d3 % 2 = 0;
SELECT format(d3, 4) FROM format_01 WHERE ABS(d3) > 1000;
SELECT COUNT(format(d1, 2)) FROM format_01 GROUP BY d1;
SELECT * FROM format_01 ORDER BY format(id, 0) DESC;


-- Mathematical function
-- @bvt:issue#7356
SELECT ABS(format(d3,0)) FROM format_01;
SELECT CEIL(format(d2, 4)), FLOOR(format(d3, 2)), ROUND(format(d4, 0)) FROM format_01;
SELECT SIN(format(d1,2)), TAN(format(d3, 0)), COS(format(d4,0)) from format_01;
SELECT cot(format(45, 0)), ACOS(format(60, 1)), ATAN(format(75, 0)), SINH(format(90, 1));
SELECT power(format(2,1), 2);
SELECT LOG(format(d1, 1)) as a, LN(format(d2, 2)) as FROM format_01;
SELECT EXP(format(4, 2));
SELECT SUM(format(3, 2)),AVG(format(d2, 0)) FROM format_01;
SELECT COUNT(format(d3,2)) FROM format_01;
SELECT MAX(format(d1, 1)), MIN(format(d2, 0)) from format_01;
-- @bvt:issue


-- @suite
-- @setup
DROP TABLE IF EXISTS format_02;
CREATE TABLE format_02(id INT, d1 FLOAT, d2 DOUBLE NOT NULL);

-- floatã€double
INSERT INTO format_02 VALUES(1, 1.2, 47832.434);
INSERT INTO format_02 VALUES(2, -3283.33, 73.32);
INSERT INTO format_02 VALUES(3, NULL, 32789.33);
INSERT INTO format_02 VALUES(4, 0, -38902093.4324);

INSERT INTO format_02 VALUES(5, 323232.0, 0);
INSERT INTO format_02 VALUES(6, 323, 37827329.43432);


-- Abnormal insertion
INSERT INTO format_02 VALUES(6, -1.8976931348623157E+308, 0);
INSERT INTO format_02 VALUES(7, 328739232, NULL);
INSERT INTO format_02 VALUES(8, 7382,3923404.2132421);

SELECT d1, d2 FROM format_02 WHERE format(d2,0) IS NOT NULL;
SELECT * from format_02 WHERE format(d2, 3) NOT LIKE '47832.43%';

-- @bvt:issue#7356
SELECT format(d2, id) FROM format_02;
SELECT format(d2, id, NULL) from format_02;
SELECT format(d2, id, "en_US") from format_02;
SELECT format(d2,0)FROM format_02;
SELECT format(d1, id) FROM format_02 WHERE d3 % 2 = 0;
SELECT format(d2, 4) FROM format_02 WHERE ABS(d2) > 1000;
SELECT any_value(format(d1,2)) FROM format_02;
SELECT * from format_02 WHERE format(d2, 2) >= 0;
SELECT d1, d2 FROM format_02 WHERE format(d1,0) BETWEEN 0 AND 400;
SELECT * FROM format_02 WHERE format(d2, 0) NOT BETWEEN 0 AND 100;
SELECT * FROM format_02 WHERE format(d2,0) IN (73, 32789);
SELECT * FROM format_02 WHERE format(d2,0) NOT IN (73, 32789);
SELECT * from format_02 WHERE format(d1, 1) like '1.2';
SELECT * FROM format_02 WHERE format(d2, 2) MOD 2 = 0;
SELECT format(d1,0) * format(d2, 0) FROM format_02;
-- @bvt:issue


-- @suite
-- @setup
DROP TABLE IF EXISTS format_04;

CREATE TABLE format_04(a varchar(100), b varchar(100), c varchar(20));
INSERT INTO format_04 VALUES("-.12334.2","2", "en_US");
INSERT INTO format_04 VALUES("12332.123456", "4", "en_US");
INSERT INTO format_04 VALUES("12332.1","4", "en_US");
INSERT INTO format_04 VALUES("12332.2","0", "en_US");

SELECT format(a, 4) from tesformat_04t;
SELECT format(a, 2),format(b, 3) FROM format_04 WHERE b > 0;
SELECT a,b,c FROM format_04 WHERE format(b,0) = 4;

-- @bvt:issue#7356
SELECT ABS(format(b,5)) FROM format_04;
SELECT FLOOR(format(c,3)) FROM format_04;
-- @bvt:issue

-- @suite
-- @setup
DROP TABLE if exists format_05;
DROP TABLE if exists format_06;
CREATE TABLE format_05(
                          c1 int,
                          c2 bigint,
                          primary key (c1)
);
create TABLE format_06(
                          i int,
                          b bigint,
                          primary key (i)
);

-- join
INSERT INTO format_05 values ('111', '222'), ('000', '111'), ('-111', null);
INSERT INTO format_06 values (111, 999999), (0,0000000), (-1, null), (11111, 1);
SELECT c1, format(c1,1), i, format(i,1) from format_05 inner join format_06 on format_05.c1 = format_06.i order by c1 desc;
SELECT format(c2, 5) FROM format_05 join format_06 ON format_05.c1 = format_06.i;
