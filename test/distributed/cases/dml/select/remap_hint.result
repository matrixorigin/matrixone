set enable_remap_hint = 1;
create database if not exists db1;
create database if not exists db2;
create table db1.t1 (a int, b int, c int);
insert into db1.t1 values(1, 2, 3), (4, 5, 6), (7, 8, 9);
create table db2.t1 (a int, b int, c int);
insert into db2.t1 values(1, 2, 3), (4, 5, 6), (7, 8, 9);
use db1;
/*+ { "rewrites" : { "db1.t1": "select a from db1.t1" } } */ Select * from t1;
a
1
4
7
/*+ { "rewrites" : { "db1.t1": "select sum(a) as sb from db1.t1" } } */ Select l.sb from db1.t1 as l;
sb
12
/*+ { "rewrites" : { "db1.t1": "select a from db1.t1" } } */ Select * from db1.t1;
a
1
4
7
/*+ { "rewrites" : { "db2.t1": "select a from db2.t1" } } */ Select * from db1.t1;
a    b    c
1    2    3
4    5    6
7    8    9
/*+ { "rewrites" : { "db1.t1": "select a from db1.t1" } } */ Select db1.t1.c from db1.t1;
invalid input: column 'db1.t1.c' does not exist
/*+ { "rewrites" : { "db1.t1": "select a from db1.t1" } } */ Select db1.t1.a from db1.t1;
a
1
4
7
/*+ {"rewrites": {"db1.t1":"(select a,b from db1.t1 where a>1)","db2.t1":"(select a,c from db2.t1 where c<9)"}} */ select l.a,r.c from db1.t1 l join db2.t1 r on l.a=r.a;
a    c
4    6
/*+ {"rewrites": {"db1.t1":"(select a,b*10 as b,c from db1.t1)","db2.t1":"(select a,b,c from db2.t1)"}} */ select l.a,l.b,r.c from db1.t1 l join db2.t1 r on l.a=r.a;
a    b    c
1    20    3
4    50    6
7    80    9
/*+ {"rewrites": {"db1.t1":"(select a from db1.t1 where a<=4)","db2.t1":"(select a,b from db2.t1)"}} */ select l.a,r.b from db1.t1 l left join db2.t1 r on l.a=r.a where r.b is not null;
a    b
1    2
4    5
drop database if exists db1;
drop database if exists db2;
create database if not exists hint_test;
use hint_test;
drop table if exists sales;
create table sales (sale_id int primary key, product_id int, quantity int, sale_date date);
insert into sales values (1, 1, 10, '2025-01-01'), (2, 1, 15, '2025-01-02'), (3, 2, 20, '2025-01-01'), (4, 2, 25, '2025-01-03'), (5, 3, 30, '2025-01-02');
/*+ { "rewrites": { "hint_test.sales_summary": "SELECT product_id, SUM(quantity) as total_quantity, COUNT(*) as sale_count FROM sales GROUP BY product_id" } } */ select * from hint_test.sales_summary where total_quantity > 20;
product_id    total_quantity    sale_count
1    25    2
2    45    2
3    30    1
drop table if exists users;
create table users (id int primary key, name varchar(50), age int, city varchar(50));
insert into users values (1, 'Alice', 25, 'Beijing'), (2, 'Bob', 30, 'Shanghai'), (3, 'Charlie', 35, 'Guangzhou'), (4, 'David', 28, 'Shenzhen');
drop view if exists active_users;
create view active_users as select id, name, age, city from users where age between 25 and 35;
/*+ { "rewrites": { "hint_test.user_list": "SELECT * FROM active_users" } } */ select * from user_list where city = 'Shanghai';
id    name    age    city
2    Bob    30    Shanghai
drop table if exists transactions;
create table transactions (trans_id int, user_id int, amount decimal(10,2), trans_date date, trans_type varchar(20));
insert into transactions values (1, 1, 100.00, '2024-01-01', 'purchase'), (2, 1, 200.00, '2024-01-01', 'purchase'), (3, 2, 50.00, '2024-01-01', 'refund'), (4, 2, 300.00, '2024-01-02', 'purchase'), (5, 3, 150.00, '2024-01-02', 'purchase'), (6, 1, 75.00, '2024-01-03', 'refund');
/*+ { "rewrites": { "hint_test.daily_summary": "SELECT trans_date, trans_type, COUNT(*) as trans_count, SUM(amount) as total_amount FROM transactions GROUP BY trans_date, trans_type" } } */ select trans_date, trans_type, total_amount from daily_summary where trans_type = 'purchase' order by trans_date;
trans_date    trans_type    total_amount
2024-01-01    purchase    300.00
2024-01-02    purchase    450.00
drop database if exists hint_test;
set enable_remap_hint = 0;