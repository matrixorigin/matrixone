create database if not exists dd3;
use dd3;
set ivf_preload_entries = 0;
set ivf_small_centroid_threshold = 2;
set probe_limit  = 1;
CREATE TABLE vector_test_merge (
id INT PRIMARY KEY,
name VARCHAR(100),
category VARCHAR(50),
score FLOAT,
active BOOLEAN DEFAULT true,
embedding vecf32(16)
);
INSERT INTO vector_test_merge (id, name, category, score, active, embedding) VALUES
(1, 'Item A', 'cat1', 5.0, true, '[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7]'),
(2, 'Item B', 'cat1', 4.5, true, '[0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8]'),
(3, 'Item C', 'cat2', 4.0, true, '[0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]'),
(4, 'Item D', 'cat2', 3.5, false, '[0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1]'),
(5, 'Item E', 'cat3', 3.0, true, '[0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2]'),
(6, 'Item F', 'cat3', 2.5, false, '[0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3]'),
(7, 'Item G', 'cat1', 2.0, true, '[0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4]'),
(8, 'Item H', 'cat2', 1.5, true, '[0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5]'),
(9, 'Item I', 'cat3', 1.0, false, '[0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6]'),
(10, 'Item J', 'cat1', 0.5, true, '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]');
CREATE INDEX idx_vec_merge USING ivfflat ON vector_test_merge(embedding) lists=4 op_type 'vector_l2_ops';
SELECT id, name, score FROM vector_test_merge
WHERE category = 'cat1' AND active = true AND score < 3.0
ORDER BY l2_distance(embedding,  '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]')
LIMIT 2 by rank with option 'mode=pre';
id    name    score
10    Item J    0.5
7    Item G    2.0
set ivf_preload_entries = 0;
set ivf_small_centroid_threshold = 0;
set probe_limit  = 5;
CREATE TABLE vector_test_pre_bf (
id INT PRIMARY KEY,
name VARCHAR(100),
category VARCHAR(50),
score FLOAT,
active BOOLEAN DEFAULT true,
embedding vecf32(16)
);
INSERT INTO vector_test_pre_bf (id, name, category, score, active, embedding) VALUES
(1, 'Item A', 'cat1', 5.0, true, '[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7]'),
(2, 'Item B', 'cat1', 4.5, true, '[0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8]'),
(3, 'Item C', 'cat2', 4.0, true, '[0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]'),
(4, 'Item D', 'cat2', 3.5, false, '[0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1]'),
(5, 'Item E', 'cat3', 3.0, true, '[0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2]'),
(6, 'Item F', 'cat3', 2.5, false, '[0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3]'),
(7, 'Item G', 'cat1', 2.0, true, '[0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4]'),
(8, 'Item H', 'cat2', 1.5, true, '[0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5]'),
(9, 'Item I', 'cat3', 1.0, false, '[0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6]'),
(10, 'Item J', 'cat1', 0.5, true, '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]');
CREATE INDEX idx_vec_pre_bf USING ivfflat ON vector_test_pre_bf(embedding) lists=4 op_type 'vector_l2_ops';
SELECT id, name, score FROM vector_test_pre_bf
WHERE category = 'cat1' AND active = true AND score > 3.0
ORDER BY l2_distance(embedding,  '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]')
LIMIT 2 by rank with option 'mode=pre';
id    name    score
1    Item A    5.0
2    Item B    4.5
set ivf_preload_entries = 1;
set ivf_small_centroid_threshold = 2;
set probe_limit  = 5;
CREATE TABLE vector_test_pre_bf2 (
id INT PRIMARY KEY,
name VARCHAR(100),
category VARCHAR(50),
score FLOAT,
active BOOLEAN DEFAULT true,
embedding vecf32(16)
);
INSERT INTO vector_test_pre_bf2 (id, name, category, score, active, embedding) VALUES
(1, 'Item A', 'cat1', 5.0, true, '[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7]'),
(2, 'Item B', 'cat1', 4.5, true, '[0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8]'),
(3, 'Item C', 'cat2', 4.0, true, '[0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]'),
(4, 'Item D', 'cat2', 3.5, false, '[0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1]'),
(5, 'Item E', 'cat3', 3.0, true, '[0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2]'),
(6, 'Item F', 'cat3', 2.5, false, '[0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3]'),
(7, 'Item G', 'cat1', 2.0, true, '[0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4]'),
(8, 'Item H', 'cat2', 1.5, true, '[0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5]'),
(9, 'Item I', 'cat3', 1.0, false, '[0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6]'),
(10, 'Item J', 'cat1', 0.5, true, '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]');
CREATE INDEX idx_vec_pre_bf2 USING ivfflat ON vector_test_pre_bf2(embedding) lists=4 op_type 'vector_l2_ops';
SELECT id, name, score FROM vector_test_pre_bf2
WHERE category = 'cat1' AND active = true AND score > 3.0
ORDER BY l2_distance(embedding,  '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]')
LIMIT 2 by rank with option 'mode=pre';
id    name    score
1    Item A    5.0
2    Item B    4.5
set ivf_preload_entries = 1;
set ivf_small_centroid_threshold = 2;
set probe_limit  = 5;
CREATE TABLE vector_test_pre_bf3 (
id INT PRIMARY KEY,
name VARCHAR(100),
category VARCHAR(50),
score FLOAT,
active BOOLEAN DEFAULT true,
embedding vecf32(16)
);
CREATE INDEX idx_vec_pre_bf3 USING ivfflat ON vector_test_pre_bf3(embedding) lists=4 op_type 'vector_l2_ops';
INSERT INTO vector_test_pre_bf3 (id, name, category, score, active, embedding) VALUES
(1, 'Item A', 'cat1', 5.0, true, '[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7]'),
(2, 'Item B', 'cat1', 4.5, true, '[0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8]'),
(3, 'Item C', 'cat2', 4.0, true, '[0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]'),
(4, 'Item D', 'cat2', 3.5, false, '[0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1]'),
(5, 'Item E', 'cat3', 3.0, true, '[0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2]'),
(6, 'Item F', 'cat3', 2.5, false, '[0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3]'),
(7, 'Item G', 'cat1', 2.0, true, '[0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4]'),
(8, 'Item H', 'cat2', 1.5, true, '[0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5]'),
(9, 'Item I', 'cat3', 1.0, false, '[0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6]'),
(10, 'Item J', 'cat1', 0.5, true, '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]');
SELECT id, name, score FROM vector_test_pre_bf3
WHERE category = 'cat1' AND active = true AND score > 3.0
ORDER BY l2_distance(embedding,  '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]')
LIMIT 2 by rank with option 'mode=pre';
id    name    score
1    Item A    5.0
2    Item B    4.5
set ivf_preload_entries = 0;
set ivf_small_centroid_threshold = 0;
set probe_limit  = 1;
CREATE TABLE vector_test_pre_bf4 (
id INT PRIMARY KEY,
name VARCHAR(100),
category VARCHAR(50),
score FLOAT,
active BOOLEAN DEFAULT true,
embedding vecf32(16)
);
INSERT INTO vector_test_pre_bf4 (id, name, category, score, active, embedding) VALUES
(1, 'Item A', 'cat1', 5.0, true, '[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7]'),
(2, 'Item B', 'cat1', 4.5, true, '[0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8]'),
(3, 'Item C', 'cat2', 4.0, true, '[0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]'),
(4, 'Item D', 'cat2', 3.5, false, '[0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1]'),
(5, 'Item E', 'cat3', 3.0, true, '[0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2]'),
(6, 'Item F', 'cat3', 2.5, false, '[0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3]'),
(7, 'Item G', 'cat1', 2.0, true, '[0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4]'),
(8, 'Item H', 'cat2', 1.5, true, '[0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5]'),
(9, 'Item I', 'cat3', 1.0, false, '[0.9,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,0.1,0.2,0.3,0.4,0.5,0.6]'),
(10, 'Item J', 'cat1', 0.5, true, '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]');
CREATE INDEX idx_vec_pre_bf4 USING ivfflat ON vector_test_pre_bf4(embedding) lists=4 op_type 'vector_l2_ops';
SELECT id, name, score FROM vector_test_pre_bf4
WHERE category = 'cat1' AND active = true AND score > 2.0
ORDER BY l2_distance(embedding,  '[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1]')
LIMIT 2 by rank with option 'mode=pre';
id    name    score
1    Item A    5.0
2    Item B    4.5
set ivf_preload_entries = 0;
set ivf_small_centroid_threshold = 0;
set probe_limit  = 5;
drop table if exists vector_test_merge;
drop table if exists vector_test_pre_bf;
drop table if exists vector_test_pre_bf2;
drop table if exists vector_test_pre_bf3;
drop table if exists vector_test_pre_bf4;
drop database if exists dd3;
