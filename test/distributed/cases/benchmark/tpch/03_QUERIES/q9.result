use tpch;
select
nation,
o_year,
sum(amount) as sum_profit
from
(
select
n_name as nation,
extract(year from o_orderdate) as o_year,
l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
from
part,
supplier,
lineitem,
partsupp,
orders,
nation
where
s_suppkey = l_suppkey
and ps_suppkey = l_suppkey
and ps_partkey = l_partkey
and p_partkey = l_partkey
and o_orderkey = l_orderkey
and s_nationkey = n_nationkey
and p_name like '%pink%'
) as profit
group by
nation,
o_year
order by
nation,
o_year desc
;
nation	o_year	sum_profit
ARGENTINA	1997	6575.4934
ARGENTINA	1996	12913.1476
ARGENTINA	1995	109908.3997
ARGENTINA	1994	39271.1404
ARGENTINA	1993	39770.6973
ARGENTINA	1992	35740.0000
ETHIOPIA	1998	24489.1496
ETHIOPIA	1997	39665.2644
ETHIOPIA	1996	113173.0956
ETHIOPIA	1995	25732.7452
ETHIOPIA	1994	93731.1008
ETHIOPIA	1993	147385.872
ETHIOPIA	1992	66636.9616
IRAN	1998	116681.1813
IRAN	1997	50964.2584
IRAN	1996	185552.5634
IRAN	1995	103479.6512
IRAN	1994	164106.8680
IRAN	1993	100245.6590
IRAN	1992	73757.9540
IRAQ	1998	21292.0377
IRAQ	1997	128533.3496
IRAQ	1996	141170.6272
IRAQ	1995	16607.1624
IRAQ	1994	16515.2008
IRAQ	1993	138752.8297
IRAQ	1992	71365.9886
KENYA	1997	47549.3594
KENYA	1996	1866.6024
KENYA	1995	13480.5734
KENYA	1994	54826.0012
KENYA	1993	111983.0035
KENYA	1992	7651.5866
MOROCCO	1998	225961.3058
MOROCCO	1997	288732.1257
MOROCCO	1996	295243.1019
MOROCCO	1995	255208.9581
MOROCCO	1994	158194.0814
MOROCCO	1993	159196.2528
MOROCCO	1992	256151.4254
PERU	1998	35151.8682
PERU	1997	99779.3198
PERU	1996	53735.2566
PERU	1995	71954.3164
PERU	1994	73084.5552
PERU	1993	95623.4989
PERU	1992	38212.4187
UNITED KINGDOM	1998	176649.9065
UNITED KINGDOM	1997	74705.2598
UNITED KINGDOM	1996	62768.5129
UNITED KINGDOM	1995	93466.7552
UNITED KINGDOM	1994	89094.2599
UNITED KINGDOM	1993	112886.5742
UNITED KINGDOM	1992	142060.9690
UNITED STATES	1997	111352.3559
UNITED STATES	1996	78268.8638
UNITED STATES	1995	251.2274
UNITED STATES	1994	57303.1500
UNITED STATES	1993	70350.5923
UNITED STATES	1992	65369.7612
