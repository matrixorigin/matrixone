SET GLOBAL experimental_master_index = 1;
drop database if exists d1;
create database d1;
use d1;
drop table if exists t1;
create table t1(c1 int primary key, c2 int, c3 int, key(c2), unique key id1(c3));
insert into t1 select *,*,* from generate_series(1,100000) g;
insert into t1 select *,1111,* from generate_series(100001,150000) g;
drop table if exists t2;
create table t2(c0 int, c1 int , c2 int, c3 int, primary key(c0,c1),key(c2), unique key id1(c3));
insert into t2 select *,*,*,* from generate_series(1,100000) g;
insert into t2 select *,*,1111,* from generate_series(100001,150000) g;
-- @separator:table
select mo_ctl('dn', 'flush', 'd1.t1');
-- @separator:table
select mo_ctl('dn', 'flush', 'd1.t2');
select Sleep(1);
select * from t1 where c2=1;
select count(c3) from t1 where c2=1111;
select * from t1 where c3=1234;
select * from t1 where c3=5678;
select * from t1 where c2 between 1 and 3;
select * from t1 where c3 between 2 and 10;
select count(c3) from t1 where c2 between 1000 and 1100;
select count(c3) from t1 where c2 between 1000 and 1200;
select count(c3) from t1 where c2 between 1000 and 2000;
select count(c3) from t1 where c2 between 1000 and 3000;
select count(c3) from t1 where c3 between 1000 and 1100;
select count(c3) from t1 where c2 between 1000 and 2000;
select * from t1 where c2 in (1);
select * from t1 where c2 in (1,1000,2000);
select count(c3) from t1 where c2 in (1,1000,1111,2000);
select * from t2 where c2=1;
select count(c3) from t2 where c2=1111;
select * from t2 where c3=1234;
select * from t2 where c3=5678;
select * from t2 where c2 between 1 and 3;
select * from t2 where c3 between 2 and 10;
select count(c3) from t2 where c2 between 1000 and 1100;
select count(c3) from t2 where c2 between 1000 and 1200;
select count(c3) from t2 where c2 between 1000 and 2000;
select count(c3) from t2 where c2 between 1000 and 3000;
select count(c3) from t2 where c3 between 1000 and 1100;
select count(c3) from t2 where c2 between 1000 and 2000;
select * from t2 where c2 in (1);
select * from t2 where c2 in (1,1000,2000);
select count(c3) from t2 where c2 in (1,1000,1111,2000);
select c3,c2 from t1 where c2=1111 order by c3 limit 10;
select * from t1 where c2=-1;
insert into t1 values(-1,-1,-1);
select * from t1 where c2=-1;
select * from t1 where c2=-2;
drop table if exists t1;
create table t1(a varchar(30), b varchar(30), c varchar(30));
create index idx1 using master on t1(a,b,c);
insert into t1 values("Congress","Lane", "1");
insert into t1 values("Juniper","Way", "2");
insert into t1 values("Nightingale","Lane", "3");
select * from t1 where a in ("Congress","Nightingale") and b="Lane" and c in("1","2","3");
drop table if exists t1;
create table t1(a int primary key, b int unique key);
insert into t1 select result, result from generate_series(1,10000)g;
-- @separator:table
select mo_ctl('dn','flush','d1.t1');
select * from t1 where b in (1,2) for update;
drop database if exists d1;
SET GLOBAL experimental_master_index = 0;