DROP TABLE IF EXISTS t_sum_overflow;
CREATE TABLE t_sum_overflow (
id INT PRIMARY KEY AUTO_INCREMENT,
val BIGINT
);
INSERT INTO t_sum_overflow (val) VALUES (9223372036854775807);  -- MAX_BIGINT
INSERT INTO t_sum_overflow (val) VALUES (9223372036854775807);
INSERT INTO t_sum_overflow (val) VALUES (9223372036854775807);
SELECT SUM(val) AS total FROM t_sum_overflow;
Data truncation: data out of range: data type int64, SUM overflow in (9223372036854775807 + 9223372036854775807)
SELECT SUM(CAST(val AS DECIMAL(38,0))) AS total_decimal FROM t_sum_overflow;
total_decimal
27670116110564327421
DELETE FROM t_sum_overflow;
INSERT INTO t_sum_overflow (val) VALUES (100);
INSERT INTO t_sum_overflow (val) VALUES (200);
INSERT INTO t_sum_overflow (val) VALUES (300);
SELECT SUM(val) AS total FROM t_sum_overflow;
total
600
DELETE FROM t_sum_overflow;
INSERT INTO t_sum_overflow (val) VALUES (-9223372036854775808);  -- MIN_BIGINT
INSERT INTO t_sum_overflow (val) VALUES (-9223372036854775808);
INSERT INTO t_sum_overflow (val) VALUES (-9223372036854775808);
SELECT SUM(val) AS total FROM t_sum_overflow;
Data truncation: data out of range: data type int64, SUM overflow in (-9223372036854775808 + -9223372036854775808)
DELETE FROM t_sum_overflow;
INSERT INTO t_sum_overflow (val) VALUES (9223372036854775807);
INSERT INTO t_sum_overflow (val) VALUES (-9223372036854775807);
SELECT SUM(val) AS total FROM t_sum_overflow;
total
0
DELETE FROM t_sum_overflow;
INSERT INTO t_sum_overflow (val) VALUES (4611686018427387903);  -- Half of MAX
INSERT INTO t_sum_overflow (val) VALUES (4611686018427387903);
SELECT SUM(val) AS total FROM t_sum_overflow;
total
9223372036854775806
DELETE FROM t_sum_overflow;
SELECT SUM(val) AS total FROM t_sum_overflow;
total
null
DROP TABLE t_sum_overflow;
