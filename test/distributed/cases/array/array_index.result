drop database if exists vecdb2;
create database vecdb2;
use vecdb2;
drop table if exists t1;
create table t1(a int primary key,b vecf32(3), c vecf64(5));
insert into t1 values(1, "[1,2,3]" , "[1,2,3,4,5");
internal error: malformed vector input: [1,2,3,4,5
insert into t1 values(2, "[1,2,4]", "[1,2,4,4,5]");
insert into t1 values(3, "[1,2.4,4]", "[1,2.4,4,4,5]");
insert into t1 values(4, "[1,2,5]", "[1,2,5,4,5]");
insert into t1 values(5, "[1,3,5]", "[1,3,5,4,5]");
insert into t1 values(6, "[100,44,50]", "[100,44,50,60,70]");
insert into t1 values(7, "[120,50,70]", "[120,50,70,80,90]");
insert into t1 values(8, "[130,40,90]", "[130,40,90,100,110]");
select a,b,normalize_l2(b) from t1;
a    b    normalize_l2(b)
2    [1, 2, 4]    [0.2182179, 0.4364358, 0.8728716]
3    [1, 2.4, 4]    [0.20961091, 0.5030662, 0.83844364]
4    [1, 2, 5]    [0.18257418, 0.36514837, 0.91287094]
5    [1, 3, 5]    [0.16903085, 0.50709254, 0.8451542]
6    [100, 44, 50]    [0.8322936, 0.36620918, 0.4161468]
7    [120, 50, 70]    [0.81274253, 0.33864272, 0.4740998]
8    [130, 40, 90]    [0.7970811, 0.24525574, 0.5518254]
select cluster_centers(b spherical_kmeans '2,vector_l2_ops') from t1;
cluster_centers(b, 2,vector_l2_ops)
[ [0.8140391, 0.31670254, 0.4806907],[0.19485846, 0.45293573, 0.8673351] ]
select cluster_centers(b spherical_kmeans '2,vector_ip_ops') from t1;
cluster_centers(b, 2,vector_ip_ops)
[ [0.8140391, 0.31670254, 0.4806907],[0.19485846, 0.45293573, 0.8673351] ]
select cluster_centers(b spherical_kmeans '2,vector_cosine_ops') from t1;
cluster_centers(b, 2,vector_cosine_ops)
[ [0.8140391, 0.31670254, 0.4806907],[0.19485846, 0.45293573, 0.8673351] ]
SELECT value FROM  (SELECT cluster_centers(b spherical_kmeans '2,vector_cosine_ops') AS centers FROM t1) AS subquery CROSS JOIN  UNNEST(subquery.centers) AS u;
value
[0.8140391, 0.31670254, 0.4806907]
[0.19485846, 0.45293573, 0.8673351]
select a,c,normalize_l2(c) from t1;
a    c    normalize_l2(c)
2    [1, 2, 4, 4, 5]    [0.12700012, 0.25400025, 0.5080005, 0.5080005, 0.63500065]
3    [1, 2.4, 4, 4, 5]    [0.12523504, 0.30056408, 0.50094014, 0.50094014, 0.62617517]
4    [1, 2, 5, 4, 5]    [0.11867817, 0.23735633, 0.5933908, 0.47471267, 0.5933908]
5    [1, 3, 5, 4, 5]    [0.114707865, 0.3441236, 0.5735393, 0.45883146, 0.5735393]
6    [100, 44, 50, 60, 70]    [0.6602998, 0.2905319, 0.3301499, 0.39617988, 0.46220985]
7    [120, 50, 70, 80, 90]    [0.6298367, 0.26243195, 0.36740473, 0.41989112, 0.47237748]
8    [130, 40, 90, 100, 110]    [0.58908623, 0.18125731, 0.40782893, 0.45314327, 0.49845758]
select cluster_centers(c spherical_kmeans '2,vector_l2_ops') from t1;
cluster_centers(c, 2,vector_l2_ops)
[ [0.62640756, 0.24474038, 0.3684612, 0.4230714, 0.47768164],[0.121405296, 0.28401107, 0.5439677, 0.48562118, 0.6070265] ]
select cluster_centers(c spherical_kmeans '2,vector_ip_ops') from t1;
cluster_centers(c, 2,vector_ip_ops)
[ [0.62640756, 0.24474038, 0.3684612, 0.4230714, 0.47768164],[0.121405296, 0.28401107, 0.5439677, 0.48562118, 0.6070265] ]
select cluster_centers(c spherical_kmeans '2,vector_cosine_ops') from t1;
cluster_centers(c, 2,vector_cosine_ops)
[ [0.62640756, 0.24474038, 0.3684612, 0.4230714, 0.47768164],[0.121405296, 0.28401107, 0.5439677, 0.48562118, 0.6070265] ]
SELECT value FROM  (SELECT cluster_centers(c spherical_kmeans '2,vector_cosine_ops') AS centers FROM t1) AS subquery CROSS JOIN  UNNEST(subquery.centers) AS u;
value
[0.62640756, 0.24474038, 0.3684612, 0.4230714, 0.47768164]
[0.121405296, 0.28401107, 0.5439677, 0.48562118, 0.6070265]
drop database vecdb2;
