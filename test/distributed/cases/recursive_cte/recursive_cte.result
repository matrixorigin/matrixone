drop table if exists t1;
create table t1(a bigint primary key, b int unique key);
insert into t1 values (1, 2), (3, 4), (5, 6);
drop table if exists t3;
create table t3(a bigint, b int);
insert into t3 values (1, 2), (3, 4), (5, 6);
drop table if exists t2;
create table t2(a bigint, b int);
insert into t2 values (1, 2), (3, 4), (5, 6);
with recursive c as (select a from t1 union all select a+1 from c where a < 2) select * from c order by a;
a
1
2
3
5
with recursive c as (select a from t1 union all select a+1 from c where a < 2), d as (select a from c union all select a+1 from d where a < 2) select distinct tt.* from ( SELECT * FROM c UNION ALL SELECT * FROM d) tt order by tt.a;
a
1
2
3
5
with recursive c as (select a from t1 union all select a+1 from c where a < 200) select * from c;
a
1
3
5
2
4
6
3
5
7
4
6
8
5
7
9
6
8
10
7
9
11
8
10
12
9
11
13
10
12
14
11
13
15
12
14
16
13
15
17
14
16
18
15
17
19
16
18
20
17
19
21
18
20
22
19
21
23
20
22
24
21
23
25
22
24
26
23
25
27
24
26
28
25
27
29
26
28
30
27
29
31
28
30
32
29
31
33
30
32
34
31
33
35
32
34
36
33
35
37
34
36
38
35
37
39
36
38
40
37
39
41
38
40
42
39
41
43
40
42
44
41
43
45
42
44
46
43
45
47
44
46
48
45
47
49
46
48
50
47
49
51
48
50
52
49
51
53
50
52
54
51
53
55
52
54
56
53
55
57
54
56
58
55
57
59
56
58
60
57
59
61
58
60
62
59
61
63
60
62
64
61
63
65
62
64
66
63
65
67
64
66
68
65
67
69
66
68
70
67
69
71
68
70
72
69
71
73
70
72
74
71
73
75
72
74
76
73
75
77
74
76
78
75
77
79
76
78
80
77
79
81
78
80
82
79
81
83
80
82
84
81
83
85
82
84
86
83
85
87
84
86
88
85
87
89
86
88
90
87
89
91
88
90
92
89
91
93
90
92
94
91
93
95
92
94
96
93
95
97
94
96
98
95
97
99
96
98
100
97
99
101
98
100
102
99
101
103
100
102
104
101
103
105
102
104
106
103
105
107
104
106
108
105
107
109
106
108
110
107
109
111
108
110
112
109
111
113
110
112
114
111
113
115
112
114
116
113
115
117
114
116
118
115
117
119
116
118
120
117
119
121
118
120
122
119
121
123
120
122
124
121
123
125
122
124
126
123
125
127
124
126
128
125
127
129
126
128
130
127
129
131
128
130
132
129
131
133
130
132
134
131
133
135
132
134
136
133
135
137
134
136
138
135
137
139
136
138
140
137
139
141
138
140
142
139
141
143
140
142
144
141
143
145
142
144
146
143
145
147
144
146
148
145
147
149
146
148
150
147
149
151
148
150
152
149
151
153
150
152
154
151
153
155
152
154
156
153
155
157
154
156
158
155
157
159
156
158
160
157
159
161
158
160
162
159
161
163
160
162
164
161
163
165
162
164
166
163
165
167
164
166
168
165
167
169
166
168
170
167
169
171
168
170
172
169
171
173
170
172
174
171
173
175
172
174
176
173
175
177
174
176
178
175
177
179
176
178
180
177
179
181
178
180
182
179
181
183
180
182
184
181
183
185
182
184
186
183
185
187
184
186
188
185
187
189
186
188
190
187
189
191
188
190
192
189
191
193
190
192
194
191
193
195
192
194
196
193
195
197
194
196
198
195
197
199
196
198
200
197
199
198
200
199
200
with recursive c as (select a from t1 union all select c.a+1 from c, t1 as k1, t1 as k2 where c.a = k1.a and c.a = k2.a) select * from c order by a;
a
1
2
3
4
5
6
with recursive c as (select t1.a from t1, t2, t3 where t1.a = t2.a or t1.a = t3.a union all select a+1 from c where a < 6) select count(*) from c;
count(*)
60
with recursive c as (select t1.a from t1, t2, t3 where t1.a = t2.a or t1.a = t3.a union all select c.a+1 from c, t2, t3 where c.a = t2.a and c.a = t3.a and c.a < 6) select count(*) from c;
count(*)
30
with recursive c as (select t1.a from t1 union all select c.a+1 from c, t3 where c.a = t3.a and c.a < 2) select count(*) from c;
count(*)
4
with recursive c as (select a from t1 union all select a+1 from c where a < 3 union all select a+1 from c where a < 4) select count(*) from c;
count(*)
14
with recursive c as (select a from t1 union all select a+1 from c where a < 4) select * from c order by a;
a
1
2
3
3
4
4
5
with recursive c as (select a from t1 union all select a+1 from c where a < 3) select * from c order by a;
a
1
2
3
3
5
with recursive c as (select t1.a, 0 as level from t1 union all select t1.a, 0 as level from t1 join t2 on t1.a = t2.a where t1.a = 1 union all select c.a, c.level + 1 from c join t3 on c.a = t3.a where c.level < 6) select count(*) from c;
count(*)
28
with recursive c as (select t1.a, 0 as level from t1 union all select t1.a, 0 as level from t1 join t2 on t1.a = t2.a where t1.a = 1 union all select c.a, c.level + 1 from c join t3 on c.a = t3.a where c.level < 6) select count(*) from c;
count(*)
28
with recursive c as (select t1.a, 0 as level from t1 union all select t1.a, 0 as level from t1 join t2 on t1.a = t2.a where t1.a = 1 union all select c.a, c.level + 1 from c join t3 on c.a = t3.a where c.level < 6) select count(*) from c;
count(*)
28
CREATE TABLE Person(ID int, Name VARCHAR(30), Mother INT, Father INT);
INSERT Person VALUES(1, 'Sue', NULL, NULL),(2, 'Ed', NULL, NULL),(3, 'Emma', 1, 2),(4, 'Jack', 1, 2),(5, 'Jane', NULL, NULL),(6, 'Bonnie', 5, 4),(7, 'Bill', 5, 4);
WITH recursive Generation (ID) AS (SELECT Mother FROM Person WHERE Name = 'Bonnie' UNION SELECT Father FROM Person WHERE Name = 'Bonnie' UNION ALL SELECT Person.Father FROM Generation, Person WHERE Generation.ID=Person.ID UNION ALL SELECT Person.Mother FROM Generation, Person WHERE Generation.ID=Person.ID) SELECT Person.ID, Person.Name, Person.Mother, Person.Father FROM Generation, Person WHERE Generation.ID = Person.ID order by person.ID;
ID    Name    Mother    Father
1    Sue    null    null
2    Ed    null    null
4    Jack    1    2
5    Jane    null    null
CREATE TABLE employees_hierarchy (id INT PRIMARY KEY, name VARCHAR(50),manager_id INT);
INSERT INTO employees_hierarchy (id, name, manager_id) VALUES(1, 'Alice', NULL), (2, 'Bob', 1),(3, 'Charlie', 1),(4, 'David', 2),(5, 'Eve', 2),(6, 'Frank', 3);
WITH RECURSIVE employee_hierarchy_cte (id, name, manager_id, level) AS (SELECT id, name, manager_id, 0 FROM employees_hierarchy WHERE name = 'Alice' UNION ALL SELECT e.id, e.name, e.manager_id, eh.level + 1 FROM employees_hierarchy AS e JOIN employee_hierarchy_cte AS eh ON e.manager_id = eh.id) SELECT name, level FROM employee_hierarchy_cte;
name    level
Alice    0
Bob    1
Charlie    1
David    2
Eve    2
Frank    2
WITH RECURSIVE employee_hierarchy_cte (id, name, manager_id, level) AS (SELECT id, name, manager_id, 0 FROM employees_hierarchy WHERE name = 'Alice' UNION ALL SELECT e.id, e.name, e.manager_id, eh.level + 1 FROM employees_hierarchy AS e JOIN employee_hierarchy_cte AS eh ON e.manager_id = eh.id) SELECT t.name, t.level FROM employee_hierarchy_cte as t;
name    level
Alice    0
Bob    1
Charlie    1
David    2
Eve    2
Frank    2
drop table if exists t1;
create table t1(id bigint primary key, parent_id bigint, tenant_id varchar(50));
insert into t1 select *,*,* from generate_series(1000000) g;
WITH recursive tb (id, parent_id) AS (SELECT id,parent_id FROM t1 WHERE id IN ( 1937478033946447874, 1,2,3) AND tenant_id != '000000' UNION ALL SELECT c.id, c.parent_id FROM t1 c JOIN tb t ON c.id = t.parent_id WHERE c.tenant_id != '000000') select count(*) from tb;
recursive level out of range
drop table if exists t1;
drop table if exists t_cte_depth;
create table t_cte_depth(a int);
insert into t_cte_depth values (1);
set cte_max_recursion_depth = 200;
with recursive c as (select a from t_cte_depth union all select a+1 from c where a < 150) select count(*) from c;
count(*)
150
set cte_max_recursion_depth = 50;
with recursive c as (select a from t_cte_depth union all select a+1 from c where a < 100) select count(*) from c;
recursive level out of range
set cte_max_recursion_depth = 100;
drop table if exists t_cte_depth;
